import{c as Hi}from"./commonjsHelpers.Cpj98o6Y.js";function Zi(_e,Te){for(var de=0;de<Te.length;de++){const M=Te[de];if(typeof M!="string"&&!Array.isArray(M)){for(const _ in M)if(_!=="default"&&!(_ in _e)){const L=Object.getOwnPropertyDescriptor(M,_);L&&Object.defineProperty(_e,_,L.get?L:{enumerable:!0,get:()=>M[_]})}}}return Object.freeze(Object.defineProperty(_e,Symbol.toStringTag,{value:"Module"}))}var _t={exports:{}};(function(_e,Te){var de={};(function(M,_){_(Te)})(Hi,function(M){function _(r){return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(r)}function L(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Kn(r,t){for(var n=0;t.length>n;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,(i=void 0,typeof(i=function(s,o){if(typeof s!="object"||s===null)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var l=a.call(s,o||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(e.key,"string"))=="symbol"?i:i+""),e)}var i}function x(r,t,n){return t&&Kn(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function S(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&$e(r,t)}function J(r){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J(r)}function $e(r,t){return $e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},$e(r,t)}function Le(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Tt(r,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Le(r)}function P(r){var t=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,e=J(r);if(t){var i=J(this).constructor;n=Reflect.construct(e,arguments,i)}else n=e.apply(this,arguments);return Tt(this,n)}}function $(){return $=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,t,n){var e=function(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&(s=J(s))!==null;);return s}(r,t);if(e){var i=Object.getOwnPropertyDescriptor(e,t);return i.get?i.get.call(3>arguments.length?r:n):i.value}},$.apply(this,arguments)}function Ft(r,t){return function(n){if(Array.isArray(n))return n}(r)||function(n,e){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,o,a,l,u=[],c=!0,h=!1;try{if(a=(i=i.call(n)).next,e!==0)for(;!(c=(s=a.call(i)).done)&&(u.push(s.value),u.length!==e);c=!0);}catch(p){h=!0,o=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw o}}return u}}(r,t)||Wt(r,t)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Wt(r,t){if(r){if(typeof r=="string")return zt(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zt(r,t):void 0}}function zt(r,t){(t==null||t>r.length)&&(t=r.length);for(var n=0,e=Array(t);t>n;n++)e[n]=r[n];return e}function jt(r,t){var n=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=Wt(r))||t){n&&(r=n);var e=0,i=function(){};return{s:i,n:function(){return r.length>e?{done:!1,value:r[e++]}:{done:!0}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(r)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}(function(r,t){t===void 0&&(t={});var n=t.insertAt;if(typeof document<"u"){var e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n==="top"&&e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}})(".BMap_Draw_Panel{height:47px;border-radius:5px;overflow:hidden;box-shadow:0 2px 6px 0 rgba(27,124,236,.5);float:left}.BMap_Drawing .BMapDraw_Box{border-right:1px solid #d2d2d2;float:left;width:64px;height:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYUAAABjCAMAAABDl+xRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4RUY1MTQyNzhBNThFMjExQTlDQ0JCMTMzNEIzNTNBQSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4M0ExRDlFOTU4OEMxMUUyOUNDMkFCOUMwMUQzOTI2RSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4M0ExRDlFODU4OEMxMUUyOUNDMkFCOUMwMUQzOTI2RSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5MUY1MTQyNzhBNThFMjExQTlDQ0JCMTMzNEIzNTNBQSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4RUY1MTQyNzhBNThFMjExQTlDQ0JCMTMzNEIzNTNBQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkLjstsAAAMAUExURR9zsKfJ4eHr8dPk8EGMv+Lp7id8tx1vrOnu8hxtq1max0WOwCl8tpO61ou104a11mGeye3y9Sp/uDKCumKaxJO92lycyKvJ3vL3+xtqqXSmyzR8tGikzb3U5HypzHqu0sLa6x5xruXs8fL09sHW5SB1soOtzlWYxbXS5rXO4VyWwr3S4S6BuXWr0ZzD3iR5tI662VGVxazN49bh6uXv9rzW6NLg6tzn7iBzrOjx902Swu7w8napzSNvpI241srZ5rDN4TSEu6LF3UmRwsrd6s3e6oGy1BxrqabH3UyLtiN2sn2u0NDj74Wz07PL3iFuq6LB2FaWxNLj7ix8tt/p8aLG4KvG22iexmymzeLs8zqAtprC3St0rmWgylKOvDeGvDiFu2OgyyJ5tZG2032w07jR4rnU5yVyrS55sbrS5EyJurbQ4sje7VGRwNnl7D2EuKnL4rHQ5J7C29fn8fb5+maizPDz9TSCuNfX1+Pt9Dt+tCV1sUODtoOv0DqIvTiHvZrB25m+2MbZ5oKx0fj6+8ba6dPi7NHf6VSTwWmhyT+Kvyx/uNrk69fk7tjj6yNxpkeErzKEu97o7vPz8yh6tW6hyFGQv0+Uw6DD3EuMvD2KvvT09CZ6tSl3sf///1WVw/X19f7+/vb29vn5+fv7+/z8/P39/fr6+vf39/j4+CJ4syF0riF3siF0rR9vpiJ5tNLS0iJyqSNyqRtpqE2NuUyNuSuAuSF2sx9yrzyJviZ7tiN4tCV6tU6Ouil+uE6UxB5wrfz9/vr8/ff6/O30+R90seDs9ery+Mvf7vX5/O/2+iV7tpfA3N3r9M7h7r7Y6R9wqB5soiByqyF2sB9upXCoz9Pk7+Lu9Z/F34q42PT19sbc7Nvp8/r7/CJroCJyqCNyqK7O5PHy8iZ5tb/U4/T19bnP4e7z9+Tr8E6OuUiFsEiJu/b393KhxvT29zSAt06Nt5i818zb502MvKfD2VGUwtzl7Ch9t0SFuCJ1sT6IvMbc68nd7KzK4DB/t////2zsHaoAAAEAdFJOU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wBT9wclAAAO8ElEQVR42uyaeViUxx3HF8EXdje4KyuIJwjoIiwKCBrQqLhRNKJ4BCUeAV5RUGmMEjQ1McTUqAVjorlMjNNIWgKRtklQFLUv7HLfuYhnbpvQJq0xabJNE21n911g3wOYmVeWp8/zfv/g4d053pn5vDPzm/n9FOA4T4U8/YGr33P0+usPH3+9U685qthRRRwVcPTw8Vf5OiquZ8X1cOGzfUq8QvvrulvAbRm31Y794fSUMwac0eGOHH9gu4ccKI5LpPAmkEjhTSCRwptAIoXuFhBScBgDIgrHZQoyBZmCTEGmIFOQKcgUZApYFPYk+ZQdyvGXKQwkhWpVmU2aAaQw1VOlLzPoVZ77Bp5C2KE5OBQuHSrrQQaNCZ3CaC99VmFDcLnXHFIKcy/p3crc9Jq5hBQmGrubHjsbl8JNba5x4eDbQWHv5sfT9bllZS8PxaBgKOtRBvS58LOXW3VhS13hh2WPPURE4amcrtem7SWgME3vxZF+GhYFP9uby/cRU/jrHO9pd89flBNrfXmK3k9VZlQNRafg1YvQKWiYpMIwxivJFMb4k1DYqnN4rW42NoWgXFju5UVjBh89OnjMopfhQ24QBoWbXl4GvdrLK3Y6KYXNbNMrkjXz53pY94Whl3NUgTgUti7j6EObgrEoJFt+WWaxWHRVzZZIAgqzefhnY1IIMjBM3O7pneM1ffchhjEEoVN4kTE88eznoxlmPSmF2QwTtvEpW4PvHfO4X4RBPehymk8gKgWGYe4T252jYAI6hXTL1jZIwRKlsUTjU9gLB5Ejw91YFB7ItVjUBx1H7KDaYsk9gEzBwOjh3zEMs5uQwvYXtfDLCQg64qfXWVipBwVqfR4fhEYB5henABPQKQRT+mgKKiGF+QqfgsrClwqLgp6i1AHcIQtQU5QemcJjlsfgWrTNYplPSCE9z+ObIXEUR+qAoRTlhkYBZhenABPQKXykP6s+C6U+ewnfRnqys926CF3nv0EYFGbDklP5YzYVVjUblcIMivLZfENHWX4ko7De8kTBcIovo0eKcykUZqeet0n/ED6FdLbRliOwxcO92IeFGBQgf0/hoHnCbwKVwkHdWZt+Q2QjBRyJ8yyYmn+WL2qon+4wGgWYW5wCTMA5O9etnQwVvofg1GZkGz3TtpWFsw9GdApB58+nThcO2nT4XQShWqr7foBfkJfn50QUYs/nv+rhdl4gdfEPPoi7M8wtTgEmYN0jRVsprL0V+ws2hbhXbI0OsFHwYHsQh05h0eTJC8VuMODvi5BPbZth45cSnp1TJy/fvvfWZIGSA+/QIFKAuUUp/Bom4FE4x0q3bBkmhbNso1mz7hv24RV0CkvPnQsSoxB07txSZAoTJVCYu/CO+QUTzwl04+5zExEpwNziFGACEoWPbq6N1SbtKYwu6dIPvlgUUtlG21pcPIZ9SEWnsKOkxEOMgkdJyQ50CtZ3zujWzAM4u/Pw5+YWzCzha8y2knsRKcDcg0QpwAQkCprTVq39KPp0t2ZiUdCyjU6dBls87T/sgxadwhennxO/U33u9BfoFE7zdKsDx1JdmNpRtJZfRcDIHainNphbnAJMQKJwfbxN6dHjuxU7fxkGhTn2Vi8fOWfGHfb/j6BTmDx+sjgFmIBMIXQ8X+txKAT+bullD7efOBWkFrtpUSnA7OIUYAIShZnLa6z6ybvGUffcRKcw9JZgCG55oFO4VVNzWIzC4ZqaW8gUAq7X8DQR6wajY8euogeWcyrQDr1nJioFmF2cAkxA250btQqrtig4uo5xdt7GH4GabRhn5/0KxTUxCtcUiv3o/oWDQ0Z26zrsAB6Fgu/uuVm08SfHERgSpNiISgFmF6cAExBtpD37z4gI5zbvt1yCipWXMSjsOjNO1FLddebMLkIvz69g+zEpFMw5NrXI03EA1t84E4BKAWYXpwATUC3Ve0+MEwqHwj9DOAD3B+LcqV4bN26U2Knt+rhxoYQUXoDtx6VQNHaLR9FKhwHoWLkF+WYbZhenABOQzwsjKwV6BMu/sH2YQ/NDtuP5F7ZUVq4TUlhXWbmF0OPp+QjswEtzMSkEvhByefvXXQPw/GurViJTgPlFKdwHE5Ap/Owu0BY8X9vllV3NHxaI6Wsb7u5+THibd8zdfTgZhQlsD45NwfR4BozaVTQtky28cmrxkspdyBRgCXEKMAGZgmkVH4JyP6bfeftL9pIvbcf2O9/v7r6KZ953wBZ9T+b9/zHDPWPI4hB39+cxKXwzK2NxUVAl7MOwfcXFhyvdVzmXQuEMJV9jCzG9/wGjbBAyA/C9/1MylcpVnC93yiqlMnMKGYUlSiVc4KaPUmZie/+XZEwtuqEM+a6oaO/zlUplCDIFOGDiFGACOoX1AgobsSNhrtnKDSeJhAlNVCoz1nV7PNdlKJWJoYSRMOuUysWwkvuVidgUCkau8iiaUlTwxDBlpmdHULGTKXyVGM9V4lf48UgjleznQxAJE7oGvjNzbChclzpCx2bChzWhpPFIi+PjQz4/Oisx/lH8SJjATSFHi768P37nkkCsqDDY4M1iFMbABIw71a95FIYRRIV5rInPGEwYFXZg0wiONh0gjgqb/uiI0lGbEkeMWEIQjzQoY8TOEf9egRubN6IXYVBYxyv6JEls3oTSseSxeSt2lnZp5wopsXnfrbFVsvJVkqiwxNL4L/EjJONLexTOXPBI5BQNIYqQ7Mg4LCVCctaETY+Wlj66acIsiRGSg/+xM/H7f5HF5k0onUAQpzo2sUcIY3G8PLsdi665jyxOdYUcLSxHzssUZAoyBZmCTEGmIFOQKcgUZAoyBSkUgExhwCkAxX9lDbxkCjIFWTIFmYIsDoU/SdIH7z7z8bsfSCn/8d+llLdW8IykCm5HF56R2gXFHyXpvXcW3PXOe1LK3/WtlPLWChZIquB2dGGB1C4oSiTp/TsXPH3n+1LKP/2tlPLSK4A1fCu1CwukdkFR8mcpKjlx6pMTJVLKf/I3KeWtFZyUVAGs4eSn0rrw6SmJXfhU8QYtRW+cOPXWiTeklH/rL1LKWys4KakCWMPJt6V14e1TErvwtkxBpiBTkCn8X1Cg5rWCKn+tTGEgKegSgE1JA0jBGF7vajK51ocbB57CZ1XzcCisNoMeZErCoNAGXFU0014N5pFSiFjtGgNiXCdFEFIY3dLd9JZkXArtV3xbXOJuBwXjaI2Lqy8A1fkYFEygR5nQKfiAGB3tlkJXmBoZIgrqtq7X+hsJKJS3ctveWo5F4UFboWojMYWm9PA8vd/FtqvWenxdXepNLa356BRAL0KncBHOgc+AaR69FfiQUEiucnhtVTs2BVUjLFc3ySeFplN8JtXBh0YVBoVkAMwJFwDIpkgpjGabnr1htV+EzvqDgWqrZ3AotFeIKBmLQjBQVVjHj7oEwggotPPwt2NSUMFltUHT1WlG0wCHVYVOIRuY9XTTBgDSSCnA4YpMU7PTUqt50NV8IZfyz2IwKIhO3nIsCi6gPc06fOWTQA4+hVj+3mSOwKKQVw1ArZvjL261cH3JQ6ZgBq22ZRVoCClQ2f7J1mk4zyWhwd6H2lzG/4qm3JkUkkFCjvXVEY0mHT6FesFaWI9FAZav5b1WVytWSU8U6kAdXIvSQW8TuVcKSVE6urmR24eWFAMAUc6k0JQAbCZKLWjGt5FUne1ucO38kMR3lx4owNWgQS3Y7qGZkoxKIRLaBGlwGTOVk1HIMenpMMGndFVXDS44kwKtrrbbJhQ+BRe7SWY1csPsi5MLBgXI/5Iw8yX4NaJSyPNl3zqJyEaKS28Mp41VQhsz38U3z6kU6DibqendRHBqy2Yb7W17CLcbG+gU4FSqE7FGKGgpqVAtVbX10FkV3kREIRtUNRlqhSZmC+3qTzuXAm3bnaMbXPXYFOzTKIVd0NmHRnQKzQBcFMsNf29GPrWl9bgZ9U2hDtqGal8hha2MuXlAKFjHL7YCk4L94Mh+z02iJ8beKGQBIEpeD0CWUyhUXKwKo3OEFDQRYLSzKDSFRbv6p1NdFKAS8rEoxLCl2BZr2YcYdApwKom+Lx8aq1gU6ly6FZ6HszuHVcV2LqUO8pknHNr+orDa9sboJgcK9iUelYL98iLG2vG8C+xDGzoFM6gSf10VMGNR4KhRh2OpXoyKozfwq4iLrHPaqc2+qic59iPBLxaDgl+noRrp92CnqeqHQ8EsTsGMQcFH8CVrcSg0ZV1pMlzlVhBFX412GgVv+750iWulhaFTMDQKhqDRgLUipYjlTsFZkQx1/CakYd1gxMVMot24O/SGfFO4824wDNG2l17gdqIO4+ycLqCQjnF2zhJapJ0WLPruTOeFO+wKddgU6ApzMq3lXFCH+4jMp/6zkaj6vi9ke7/NC+aVDW7CoNDcw2nLG8dSFV6pYFKAO7SR1nAmkwbEOfM2z80kkQLlzymaReHcqVpPbSIFqBjhPUh/UqCTanWczykluJZ2JgW7k4SjKiz/AhPtUNSfwfMvSL/B4EljvY1IMGJSoOr9m5jsrl58Rl8Idi4FvZBCLRYFmur+iqIpGo9CMgC+0m7zBEuczWPmhkcB7tDNdLndZAw2QtOv2bkU6CgBhSw8CjST0GnlMjQmhZ5utltpIgq58AASngMnZyQmBTrCPJpWWVfnDXAelZsEF6r97+Xh6yImBfglsTZqHI1NwU3cy+NGRiHM5uyhonow83rz/vs1qOl5oK0CTsVIk+jRs18pCG9R0nAp2A9OyTQ+BckeT+6uAGz+wiuih8E+YjBcWgw0XBz1G0C1JkXc892PFHR8K8lkwKZgm1DRNAmFLu8/XJd0BN5//mUG3JpizaK3631QoFrbmmhtFqj169HM64mCqKdYi3en6sq3+Gl8Cjpf0JBLRkFqJAxnJKGdE1VfJe7+7CseKaUB1ILs9l660I+RMIIbRT0BBXp1H86uXqPCkh38LLXYUWGOMrJ2TiRNQIE2A5O21y70Y1QYncJ1+LXRJBRSGsrJKdB0hXcr/IyzW717cXAgnRfiXFqqstppIgrNvXree6Iw6fZESELTwEHV5UQU6HZaCoW+JUfO03LMtkxBpiBTkCnIFGQKMgWZgkxBpiBTkCn0M4X/CTAAQMqViQc6GXMAAAAASUVORK5CYII=);cursor:pointer}.BMap_Drawing .BMapDraw_last{border-right:none}.BMap_Drawing .BMapDraw_hander{background-position:0 0}.BMap_Drawing .BMapDraw_hander_hover{background-position:0 -52px}.BMap_Drawing .BMapDraw_marker{background-position:-65px 0}.BMap_Drawing .BMapDraw_marker_hover{background-position:-65px -52px}.BMap_Drawing .BMapDraw_circle{background-position:-130px 0}.BMap_Drawing .BMapDraw_circle_hover{background-position:-130px -52px}.BMap_Drawing .BMapDraw_polyline{background-position:-195px 0}.BMap_Drawing .BMapDraw_polyline_hover{background-position:-195px -52px}.BMap_Drawing .BMapDraw_polygon{background-position:-260px 0}.BMap_Drawing .BMapDraw_polygon_hover{background-position:-260px -52px}.BMap_Drawing .BMapDraw_rectangle{background-position:-325px 0}.BMap_Drawing .BMapDraw_rectangle_hover{background-position:-325px -52px}.BMapDraw_tip{position:absolute;top:50px;display:none;overflow:hidden;width:162px;height:40px;border:1px solid #ccc;line-height:20px;border-radius:4px;background-color:#fff;text-align:center;font-size:12px}.BMapDraw_tip_text{font-size:12px;color:#999}.BMapDraw_tip.polyline{right:135px}.BMapDraw_tip.rectangle{right:65px}.BMapDraw_tip.polygon{right:5px}.BMapDraw_tip.circle{right:-45px}.BMapDraw_tip p{margin:0}.screenshot{position:absolute;background:#fff;border:1px solid #e9e9e9;border-radius:2px;color:#333;padding:0 4px;font-size:12px}.screenshot .unit{display:block;color:#999;width:12px;float:right}.screenshot .circlShot{width:50px;text-align:center;line-height:30px;height:30px}.screenshot #screenshotNum{display:inline-block;height:30px;text-align:center;cursor:text}.screenshot #circleInput{display:none;border:none;width:34px;height:30px;margin-top:-1px;outline:none;-moz-user-select:none;user-select:none;-moz-appearance:listitem;appearance:listitem;-webkit-user-select:none;-webkit-appearance:listitem;padding:0;font-family:inherit;font-size:inherit;line-height:inherit;color:inherit}.screenshot #circleInput:focus{outline:none;border:none}.screenshot .rectWH{width:120px;height:30px;line-height:30px;padding:2px 0}.screenshot .rectWH span{display:inline-block;width:10px;text-align:center}.screenshot .rectWH .multiple{color:#999}.screenshot .rectWH .wh{display:inline-block;width:45px}.screenshot .rectWH .wh #rectHeight,.screenshot .rectWH .wh #rectWidth{width:33px;cursor:text}.screenshot .rectWH .wh #rectHeightInput,.screenshot .rectWH .wh #rectWidthInput{display:none;border:none;width:34px;height:30px;margin-top:-1px;outline:none;-moz-user-select:none;user-select:none;-moz-appearance:listitem;appearance:listitem;-webkit-user-select:none;-webkit-appearance:listitem;padding:0;font-family:inherit;font-size:inherit;line-height:inherit;color:inherit}.screenshot .rectWH .wh #rectHeightInput:focus,.screenshot .rectWH .wh #rectWidthInput:focus{outline:none;border:none;padding:0}.screenshot:focus-within,.screenshot:hover{border:1px solid #5e87db}.operateWindow{position:absolute;-webkit-user-select:none;-moz-user-select:none;user-select:none}.operateWindow>.containerbox{width:270px;height:35px}.operateWindow>div>span{display:block;float:left;margin:2px 0;text-align:center;cursor:pointer}.operateWindow div #confirmOperate{margin-left:15px;background:#fff url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAwxJREFUaAXtmE1oE0EUx2fWNCkpfkA9iXeN0tbqYVNUFISCJ1GoiPhxELWtx3oQRBA8iR48iEkPJYIeilK8qChFxJOJSlNsxYhFFKviIVQqqTUm+5wpmTIpm+xHNpspfXt5szOzb/6//+zO7iwheKAD6AA6gA6gA+gAOoAOoAPoADqADqADK88BupyQhzI7V+d/zd4AQg4x4T81CgNn9clHThiWDfDdpL7mN5l7CgBRAcjEzxMSiPR1jX8WdVZRs+qgQrsZLNfFZrqZUNjtRKPywJVgBSSlxpQo24lKA1vBEkoTvfrESzugoo+ywCXYJ/IzK0TzSCkZXq9vPi3X2SkruWhJsF1mEBy2VY8cO0zvF83aq9UpB1xPWG6EUsD1hlUK2A9YZYD9glUC2E9Yx8CPP+4PTc/8iIQg+PWk/irLE9Ry+A3Ltdp+D8ded3R+yU5PFYqFdM6Y+xZPtp/3AJZ/G3v+6qmmyzYwFI0YE7exlCxkgHEtlmy/Xi15pTZpZhc3AnLfWt6zch6zsm1gArB1aQIAY+BWsm0Q4LLtPBKsrzMrtNsWyr7lXoiLyiLAmXhy5M5z2Bsoqzc5aTQsl2QbuInQXgb9yYSDbdPgaCaVHeGLmlk7r1MBlutw9KU1NNa5IZ//NwpAtvCLlx6U0GctYXrgRMfbnNxW+lPh+wIlaxBl2zPMLzi1Pf1dC4T2MLAxkUCObKb35f7AaCK9bZ2oVwmWa3I0wwJi8M2OtcXC34fsXt4l6soiJePNwaZuCIfn2T8oJWZW6HMFzC9m0GEG/YBBd4tkcqSUfmDnM9X2s263ePI4TsuugflA9971BLOzmWF2Kx90MnA937NWOmoCXoCGnlXZ1PsEW8iOWw3G2xsJuzC+HZFWfdhtS+OptpsMur9a30bDcm2OVulKMOx5hb7o5Dmi0auV+7j/LVMpp5t6T4DFwP36xAWiaRfFuYgqzOyiFlHwMrJNxRFCjEvsFm+hRLvdGt10xc0PNy81YS50AB1AB9ABdAAdQAfQAXQAHUAH0AF0YCU78B/Xn4einv7Y7QAAAABJRU5ErkJggg==) no-repeat top;background-size:contain}.operateWindow div #cancelOperate,.operateWindow div #confirmOperate{float:left;width:50px;height:30px;box-shadow:0 2px 4px 0 rgba(0,0,0,.3);border-radius:2px}.operateWindow div #cancelOperate{margin-left:8px;background:#fff url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAupJREFUaAXtmTtvFDEQx2eWQ4ICISRaegq6hI4CCSEkQgkRgi6QkhRwCOiOGlIAouIhUhGSAqVFQgr1HWW+AvcBIo7myDB25GjX571drx8NY+m0a589M7//+rVeAEmigCggCogCooAoIAqIAqKAKCAKiAKiwP+nAIYi051LZ2D65w0Q3ODfGI7hU/wy2gm1a9rTzYUHgPgYgE6y/U9w4dQzHOxOzf++18K3wUx9BXsAdzmY0/zfefhLX+nW4r2Zeh0KaHnhJTd7DUTn2P5Zvu/D3n6/g6mjJuHA6slWE3KA70Khuf06C/moalrl0PY3W2VOSQzgscN+ELSGJXrosMs9m345y1sWhgPzmGVf5PDXCVp34zpYgAkcL547fLUuCgbWExTiagxoDevsxppnAj1cws/DvdZ0jorBs7Sxqccsj13Ou2wSz7SruD36YOrb11awm6Ndu51v3hWcr42j+l2hc8GqQKMCK4O+0DlhkwD7QOeGTQbcDhq+8dx+TdV1pMMJKsKYtW1H79JlBw3du1y1fJ8MVjlJCqwceEInhc0C7AGdHFbFErzxUEaakl5/kcdsfeJ1mt5igjFru8wCrGfj+glKxcTbUOzr7m9HGDmffgyrV7z67aKN07gjsxv45pM+4YZ1NtoLhw90MuAG2AkU+IIDzQ6dBLgRVr31bI2eMPT93NDRx3Ar2NJsTMuLK3BA7xncFUv0Me1y4jMkKnV9YU3jnNDRgHlJWefjF/exjDqpwOI6bg9/GEj7mgs6CnAorIHPAR0MzN14jdfZVyboyhXhN2/mluY92Up9zjRC94qruDn8brdrmw+fpXmH5HTWAVbZ4dn749zZe0qOo1tnBM7CcGD1RcBOHWGNmQboWX+mYYtrOLD6/FFOgbDGVC10QVV/pkHLa/gYHlzuHX7+0F8ExnyUOgg9Si3HTrcvXgHVjZFO8Eq9gVs/N8r/y70oIAqIAqKAKCAKiAKigCggCogCooAo0EGBf6iFZapSQC/BAAAAAElFTkSuQmCC) no-repeat top;background-size:contain}.operateWindow div #warnOperate{float:left;width:200px;height:30px;margin-left:4px;line-height:30px;background:#fffbcc;border:1px solid #e1e1e1;border-radius:2px;font-family:PingFangSC-Regular;font-size:14px;color:#703a04;letter-spacing:0;cursor:default}.operateLeft p span{float:right}");var I={STATUS_FREE:"free",STATUS_DRAWING:"drawing",STATUS_EDITER:"editer",STATUS_MOVE:"move"},k={INIT:"operate-init",COMPLETE:"operate-ok",CANCEL:"operate-cancel",CHANGE:"operate-change",CLICK:"mouse-click",RIGHTCLICK:"right-click",MOVE:"mouse-move"},et={AREA_END:"measure-area-end",LENGTH_END:"measure-length-end"},X={DRAW_ON_MAP:"draw-on-map",EDIT_ON_MAP:"edit-on-map",SELECT_ON_MAP:"select-on-map",MOVE_ON_MAP:"move-on-map",DRAW_NO_MAP:"draw-no-map",SELECT_NO_MAP:"select-no-map",DRAW_ON_MAP_CANCEL:"draw-on-map-cancel",EDIT_ON_MAP_CANCEL:"edit-on-map-cancel",SELECT_ON_MAP_CANCEL:"select-on-map-cancel",MOVE_ON_MAP_CANCEL:"move-on-map-cancel"},B={DRAWING_POINT:"point",DRAWING_MARKER:"marker",DRAWING_POLYLINE:"polyline",DRAWING_POLYGON:"polygon",DRAWING_CIRCLE:"circle",DRAWING_RECTANGLE:"rectangle"},Ut=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6Q
    AAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4z
    w7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e3
    5dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkc
    ia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrN
    bQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBS
    gAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN
    +/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC`,Yt=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.gif",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(82,174),imageOffset:new BMapGL.Size(0,14)}),Jt=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.png",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(37,442),imageOffset:new BMapGL.Size(25,312)}),Hn=new BMapGL.Icon("//maponline0.bdimg.com/sty/map_icons2x/MapRes/shenghui_1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),Zn=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),tt=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit2.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),xe={borderRadius:"2px",background:"#FFFBCC",border:"1px solid #E1E1E1",color:"#703A04",fontSize:"12px",letterSpacing:"0",padding:"5px"},qn={operate:null,isOpen:!1,isOnMap:!0,isSeries:!0,skipEditing:!1,isSelectDraw:!1,enableCalculate:!1,enableSnap:!0,snapDistance:10,drawCursor:"crosshair",keyCode:87,baseOpts:{icon:Hn,node:Zn,nodeT:tt,fillColor:"#1990FF",fillOpacity:.2,strokeColor:"#877efb",strokeWeight:3,strokeOpacity:1,enableDragging:!0},labelOptions:xe,matchOverlay:{type:"Circle",radius:2,icon:tt,strokeColor:"#fff",strokeStyle:"solid",strokeWeight:2},centerIcon:new BMapGL.Icon(`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6Q
    AAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9f
    fvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi
    367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rh
    IFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6d
    dQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/
    BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05
    pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQl
    SwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnO
    OZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrB
    Tf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==`,new BMapGL.Size(20,20)),circleMoveIcon:new BMapGL.Icon(`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs
    4c6QAABcdJREFUeAHtm0FoHFUYx7+ZbDfJJiZUqcEgBU3BqtGKRdGLHsSTSGxL8agUT230YtGTDQl6EKt4CD1JqPQkastSPImIvVSUQINR
    K1jrQVNSRRGz3WST3fH/f5k3THY3mmzejLub74Mv8/bNzJv3fnwz773v+yKiogSUgBJQAkpACSgBJaAElIASUAJKQAkoASWgBJSAElACSk
    AJKIH2J+A1OsQgCIZw7wh0P3Qwpr0oN7MsoHNzMZ1GOe953pVGOr0pgIB2Kx4yCj0AHW7kgU18zyz6dg46CZjXN9rPDQEEOFrVy9DjUGNh
    haIEX8+WvEuXy/LbnxX5468AWpHF0kYf/f9c190psrPPl5v7Pdm105cH9nbIQ8PZoKdbLAta6Eno2wDJ8r+KvWndiwDvIE6egg7wooszy/
    LJhZJ8e6UslQprWl98X+TeoQ556rGsPLpvhx3QPApHAfGsrah3XBcgwPHcCegY1Pv+pxU5nV+Sy1fL9dppm7q9d3TI8yOdcvedGY4pgI5D
    JwCS5RqpCxDwunHl+9DDlUCCqbOL3vkvmvzdrBna1iqefjwrRw52Bb5nXu0P0dpzgFisbrUGYGh5H+DCw4ViELw5dcOb+aG9ra4aiv2976
    4OefVIDt9Hj5wI8dlqS8TbXyN8bQ28V94pbFt4pELDIQMaEplAyWaNrAEYThhjfG1peb/Mt8kssWbIm/tBBmRBJrhzLGQUNRIBxAkuTzjb
    evzmbdfXNiITK5AFmZAN9FTIylwRAcQvrvMGONtutwnDkPiPP2RCNmQEJSsjBiCIcofBRbJZqpgzjv88cn8GC1azNHDW8qEns7L7trgNOG
    u6bkNcxoVyPGQm9ukv4kQvF8lJrfN6cx5mtG6nEG/p9+X10VxqEMmGjMgKOsqCBfgMf3CHkZQsw/p3ZNxCLOPL3n9TuhBjjOgPEB+mSK/K
    MPe23J4lJdPfLcvfhcApxM++XJZyOV2IZERWZEZ2tEC6pOSrb0peknvbhRsir00WnEL8ea4ib50upgqRjMiKzCAjBEh/nlxKYbdx9deKc4
    gXZ1ZShxhb4u0nQDpD5Xe4pNKQdoBI910ogxFA+vPSklaHGGMVBxhRTYVjK0Ok4zgUA9CYnvE32OqUjoSIfaZ5ml3i3D7Al6Jx4TfRLni5
    xJk4lpPObOPt1bszxipgb6/xIrq50xa40eG87Ioem/+8JFt1YAzu8uXAE6vEuE6cOrcoS46XtzFW10iNESoTI4hGkkKB8CaO9cie3R3maR
    99uiRnzkdbpYZ6QHhvvJTDWHwhvHfPFOXCtNm/NtTeejcxnhLKXASQAZa0pJXhkVGMlQHIuKjQ+5qGtDo8MmIkL5Rpml2ePx6+LxswOpWk
    tAM8MmIYNOSU9+HjZ0R+FoPzGNpLSjJo2vU3r6/XS+WbF2dCRmRFZmRnbY4ReRMXjV/ssvzgPRmnEwb7xshZ0hNGNQPGjkMxzCzASVQuMK
    jMuGgS0tezOnO5mG1t/xAtS3S2tc+xR7IJA+/MWCCzVX8gTJG5IExnMEFlHl0L41ou4bF/SS5V6o2fAfdQTobMonwQgW+LXtYfoQPvfbzo
    PC6SgTd/xfGSLIssjJJxENtxJXfk5+KFQ2bRP4+n7AFAWmHkkZaw4ijqAkbkXS9rXMNj59OCRxZkQjZQ5ssYeOyD/QayTIhMpBlnOgMj8l
    vdl5pGW/wPGZBFmOIxHjKKRhXtSWwNXmXWaWoHIGwktaMGIEECInaqmlzUUHIRAVJCSzyB4hhU09s2k95GgFYAUhMsLYw6x7qvcPV1gMgl
    Tk2KL6NTDEYxntIqKb5d2Ehw92JTfPmdox8g3J5x6JxhuSZ2k+LLFq0AJFNAmMXAQPywrW+T4yzGkUySeT1AgDmEesaUGRZlZM8qrbWZhR
    ZGJ7LVLf2bQzMPVPumBJSAElACSkAJKAEloASUgBJQAkpACSgBJaAElIASUAJKQAkoAVcE/gG4Wba8Vno8+QAAAABJRU5ErkJggg==`,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),moveIcon:new BMapGL.Icon(Ut,new BMapGL.Size(10,10)),limitPoint:-1},$n={tips:"测距",unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",skipEditing:!0,enableCalculate:!0,turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:.8,fillOpacity:.2},labelOptions:xe},ei={unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:1},labelOptions:xe},Xt={icon:tt,nodeT:null,node:null,fillColor:"#fff",fillOpacity:.1,strokeColor:"#00f",strokeWeight:2,strokeOpacity:.6,strokeStyle:"dashed"},ti={strokeColor:"#fff",strokeStyle:"solid",strokeWeight:"2"},ni=["marker","polyline","polygon","circle","rectangle"],m={grid:"$BAIDU$",guid:function(){return window[m.grid]||(window[m.grid]={}),window[m.grid]._counter=window[m.grid]._counter||1,window[m.grid]._instances=window[m.grid]._instances||{},"TANGRAM__"+(window[m.grid]._counter++).toString(36)},isString:function(r){return Object.prototype.toString.call(r)==="[object String]"},isFunction:function(r){return Object.prototype.toString.call(r)==="[object Function]"},isArray:function(r){return Array.isArray?Array.isArray(r):Object.prototype.toString.call(r)==="[object Array]"},isObject:function(r){return Object.prototype.toString.call(r)==="[object Object]"},copyOptionsToNew:function(r,t,n){for(var e in t)if(r.hasOwnProperty(e)){if(!t[e]||t[e]instanceof Array||t[e]instanceof BMapGL.Icon||t[e]instanceof BMapGL.Symbol||t[e].ignore){n[e]=t[e];continue}if(t[e]!==null&&_(t[e])==="object"&&Object.keys(t[e]).length===0)continue;t[e]!==null&&_(t[e])==="object"&&Object.keys(t[e]).length>0?(n[e]={},this.copyOptionsToNew(r[e],t[e],n[e])):n[e]=t[e]}},copyNotExitOptions:function(r,t){var n=this,e=function(s){if(r.hasOwnProperty(s))["baseOpts","labelOptions","matchOverlay"].findIndex(function(o){return s===o})!==-1&&n.copyNotExitOptions(r[s],t[s]);else{if(!t[s]||t[s]instanceof Array||t[s]instanceof BMapGL.Icon||t[s]instanceof BMapGL.Symbol||t[s].ignore)return r[s]=t[s],"continue";t[s]!==null&&_(t[s])==="object"?(r[s]={},n.copyNotExitOptions(r[s],t[s])):r[s]=t[s]}};for(var i in t)e(i)},copyOptions:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var e in t)if(r&&r.hasOwnProperty(e)){if(t[e]instanceof Array||t[e]instanceof BMapGL.Icon||t[e]instanceof BMapGL.Symbol||this.shotObject(t[e],n)){r[e]=t[e];continue}t[e]!==null&&_(t[e])==="object"?this.copyOptions(r[e],t[e],n):r[e]=t[e]}},shotObject:function(r,t){var n=!1;return t.forEach(function(e){if(r instanceof e)return n=!0,!0}),n},deepCopy:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;for(var s in n?e++:(n={},e=1),r)r[s]instanceof Array||r[s]instanceof BMapGL.Icon||r[s]instanceof BMapGL.Symbol||this.shotObject(r[s],i)?n[s]=r[s]:t>=e&&m.isObject(r[s])&&Object.keys(r[s]).length>0?(n[s]={},this.deepCopy(r[s],t,n[s],e,i)):n[s]=r[s]},getTarget:function(r){var t=window.event||r;return t.target||t.srcElement},getEvent:function(r){return window.event||r},preventDefault:function(r){var t=m.getEvent(r);t.preventDefault?t.preventDefault():t.returnValue=!1},stopBubble:function(r){var t=m.getEvent(r);t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},on:function(r,t,n,e){t=t.replace(/^on/i,""),r=m.getdom(r);var i=n,s=t;return t=t.toLowerCase(),r.addEventListener?r.addEventListener(s,i,!1):r.attachEvent&&r.attachEvent("on"+s,i),r},un:function(r,t,n,e){r=m.getdom(r);for(var i,s,o,a=e.length,l=!n;a--;)(i=e[a])[1]!==t||i[0]!==r||!l&&i[2]!==n||(s=i[4],o=i[3],r.removeEventListener?r.removeEventListener(s,o,!1):r.detachEvent&&r.detachEvent("on"+s,o),e.splice(a,1));return r},getdom:function(r){return m.isString(r)?document.getElementById(r):r},addClass:function(r,t){r=m.getdom(r);for(var n=t.split(/\s+/),e=r.className,i=" "+e+" ",s=n.length,o=0;s>o;o++)0>i.indexOf(" "+n[o]+" ")&&(e+=(e?" ":"")+n[o]);return r.className=e,r},mc2ll:function(r,t){var n=t.mercatorToLnglat(r.lng,r.lat);return new BMapGL.Point(n[0],n[1])},ll2mc:function(r,t){var n=t.lnglatToMercator(r.lng,r.lat);return new BMapGL.Point(n[0],n[1])},getPointByDistance:function(r,t,n){var e,i,s,o=t/6378800,a=Math.PI/180*r.lat,l=Math.PI/180*r.lng;switch(n){case"North":case"north":case"N":case"n":e=0,i=r.lng;break;case"West":case"west":case"W":case"w":e=90,s=r.lat;break;case"South":case"south":case"S":case"s":e=180,i=r.lng;break;case"East":case"east":case"E":case"e":e=270,s=r.lat;break;default:e=~~n}var u=Math.PI/180*e,c=Math.asin(Math.sin(a)*Math.cos(o)+Math.cos(a)*Math.sin(o)*Math.cos(u)),h=new BMapGL.Point(i||((l-Math.atan2(Math.sin(u)*Math.sin(o)*Math.cos(a),Math.cos(o)-Math.sin(a)*Math.sin(c))+Math.PI)%(2*Math.PI)-Math.PI)*(180/Math.PI),s||c*(180/Math.PI));return h.lng=parseFloat(h.lng.toFixed(6)),h.lat=parseFloat(h.lat.toFixed(6)),h},throttle:function(r,t,n){if(typeof r!="function")return Function();var e=null,i=null;return function(s){var o=s,a=+new Date;!i&&(i=a),n&&a-i>n?(r(o),i=a):(clearTimeout(e),e=setTimeout(function(){r(o),i=null},t))}}},nt=function(r){for(var t=arguments.length,n=Array(t>1?t-1:0),e=1;t>e;e++)n[e-1]=arguments[e];var i=function(o){S(l,o);var a=P(l);function l(){var u;L(this,l);for(var c=arguments.length,h=Array(c),p=0;c>p;p++)h[p]=arguments[p];return u=a.call.apply(a,[this].concat(h)),n.forEach(function(f){s(Le(u),new f)}),u}return x(l)}(r),s=function(o,a){Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a)).forEach(function(l){l.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(o,l,Object.getOwnPropertyDescriptor(a,l))})};return n.forEach(function(o){s(i.prototype,o.prototype),s(i,o)}),i},A=x(function r(t,n){L(this,r),this.type=t,this.returnValue=!0,this.target=n||null,this.currentTarget=null}),j=function(){function r(){L(this,r),this._listeners={}}return x(r,[{key:"addEventListener",value:function(t,n,e){if(m.isFunction(n)){!this._listeners&&(this._listeners={});var i,s=this._listeners;if(typeof e=="string"&&e){if(/[^\w\-]/.test(e))throw"nonstandard key:"+e;n.hashCode=e,i=e}t.indexOf("on")!==0&&(t="on"+t),_(s[t])!=="object"&&(s[t]={}),i=i||m.guid(),n.hashCode=i,s[t][i]=n}}},{key:"removeEventListener",value:function(t,n){if(m.isFunction(n))n=n.hashCode;else if(!m.isString(n))return;!this._listeners&&(this._listeners={}),t.indexOf("on")!==0&&(t="on"+t);var e=this._listeners;e[t]&&e[t][n]&&delete e[t][n]}},{key:"dispatchEvent",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var e in!this._listeners&&(this._listeners={}),m.isString(t)&&(t=new A(t)),n)t[e]=n[e];var i=this._listeners,s=t.type;if(s.indexOf("on")!==0&&(s="on"+s),m.isFunction(this[s])&&this[s].apply(this,arguments),_(i[s])==="object")for(var o in i[s])i[s][o].apply(this,arguments);return t.returnValue}},{key:"dispose",value:function(){for(var t in this._listeners)for(var n in this._listeners[t])delete this._listeners[t][n]}},{key:"defineProperty",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;for(var s in e===void 0?(e=this,i=1):i++,t)e&&e.hasOwnProperty(s)&&(t[s]instanceof Array||t[s]instanceof BMapGL.Icon||t[s]instanceof BMapGL.Symbol?e[s]=t[s]:n>i&&m.isObject(t[s])&&Object.keys(t[s]).length>0?this.defineProperty(t[s],n,e[s],i):e[s]=t[s])}},{key:"setSnapPointType",value:function(t){var n,e;((n=t.matchOverlay)===null||n===void 0?void 0:n.type)==="Marker"?this.matchOverlay=new BMapGL.Marker(new BMapGL.Point(116.395,39.935),t.matchOverlay):((e=t.matchOverlay)===null||e===void 0?void 0:e.type)==="Circle"?(!t.matchOverlay.radius||(this.matchOverlayRadius=t.matchOverlay.radius),this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,t.matchOverlay)):this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,ti)}},{key:"setSceneStatus",value:function(t){this.scene.currentStatus=t}}]),r}(),it=function(r){S(n,r);var t=P(n);function n(e){var i;return L(this,n),(i=t.call(this)).delayLimit=100,i.minLimit=200,i.overlayData=[],i.click=void 0,i.mousemove=void 0,i.rightclick=void 0,i.map=e,i.open(),i}return x(n,[{key:"open",value:function(){this.openClick(),this.openMouse(),this.openRightClick()}},{key:"linkOverlayData",value:function(e){this.overlayData=e}},{key:"clickAction",value:function(e){this.dispatchEvent(new A(k.CLICK,e))}},{key:"rightclickAction",value:function(e){this.dispatchEvent(new A(k.RIGHTCLICK,e))}},{key:"mouseAction",value:function(e){e&&this.dispatchEvent(new A(k.MOVE,e))}},{key:"openClick",value:function(){this.click||this.map.addEventListener("click",this.click=this.clickAction.bind(this))}},{key:"openRightClick",value:function(){this.rightclick||this.map.addEventListener("rightclick",this.rightclick=this.rightclickAction.bind(this))}},{key:"openMouse",value:function(){this.mousemove||(this.mousemove=m.throttle(this.mouseAction.bind(this),this.delayLimit,this.minLimit).bind(this),this.map.addEventListener("mousemove",this.mousemove))}},{key:"close",value:function(){this.closeClick(),this.closeMouse()}},{key:"closeClick",value:function(){this.click&&(this.map.removeEventListener("click",this.click),this.click=null)}},{key:"closeMouse",value:function(){this.mousemove&&(this.map.removeEventListener("mousemove",this.mousemove),this.mousemove=null)}},{key:"intersectOverlays",value:function(e){for(var i=[],s=0;this.overlayData.length>s;s++){var o=this.overlayData[s];if(""+o!="Marker"){var a=(""+o!="Polyline"?o._getInPnpoly(e.point):o._getProximity(e.point)).dist;a>=0&&o._config.mouseOverTolerance>a&&i.push(o)}else o._getInPnBox(e.pixel)&&i.push(o)}return i.length>0?i:null}}]),n}(j),D=63710088e-1,rt={centimeters:100*D,centimetres:100*D,degrees:D/111325,feet:3.28084*D,inches:39.37*D,kilometers:D/1e3,kilometres:D/1e3,meters:D,metres:D,miles:D/1609.344,millimeters:1e3*D,millimetres:1e3*D,nauticalmiles:D/1852,radians:1,yards:1.0936*D},st={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function U(r,t,n){n===void 0&&(n={});var e={type:"Feature"};return(n.id===0||n.id)&&(e.id=n.id),n.bbox&&(e.bbox=n.bbox),e.properties=t||{},e.geometry=r,e}function G(r,t,n){if(n===void 0&&(n={}),!r)throw Error("coordinates is required");if(!Array.isArray(r))throw Error("coordinates must be an Array");if(2>r.length)throw Error("coordinates must be at least 2 numbers long");if(!je(r[0])||!je(r[1]))throw Error("coordinates must contain numbers");return U({type:"Point",coordinates:r},t,n)}function ge(r,t,n){n===void 0&&(n={});for(var e=0,i=r;i.length>e;e++){var s=i[e];if(4>s.length)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;s[s.length-1].length>o;o++)if(s[s.length-1][o]!==s[0][o])throw Error("First and last Position are not equivalent.")}return U({type:"Polygon",coordinates:r},t,n)}function R(r,t,n){if(n===void 0&&(n={}),2>r.length)throw Error("coordinates must be an array of two or more positions");return U({type:"LineString",coordinates:r},t,n)}function V(r,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=r,n}function Fe(r,t,n){return n===void 0&&(n={}),U({type:"MultiLineString",coordinates:r},t,n)}function Vt(r,t,n){return n===void 0&&(n={}),U({type:"MultiPoint",coordinates:r},t,n)}function Oe(r,t,n){return n===void 0&&(n={}),U({type:"MultiPolygon",coordinates:r},t,n)}function ot(r,t){t===void 0&&(t="kilometers");var n=rt[t];if(!n)throw Error(t+" units is invalid");return r*n}function We(r,t){t===void 0&&(t="kilometers");var n=rt[t];if(!n)throw Error(t+" units is invalid");return r/n}function Qt(r,t){return me(We(r,t))}function me(r){return 180*(r%(2*Math.PI))/Math.PI}function T(r){return r%360*Math.PI/180}function ze(r,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),r<0)throw Error("length must be a positive number");return ot(We(r,t),n)}function je(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ae(r){return!!r&&r.constructor===Object}var ii=Object.freeze({__proto__:null,earthRadius:D,factors:rt,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/D,yards:1.0936133},areaFactors:st,feature:U,geometry:function(r,t,n){switch(r){case"Point":return G(t).geometry;case"LineString":return R(t).geometry;case"Polygon":return ge(t).geometry;case"MultiPoint":return Vt(t).geometry;case"MultiLineString":return Fe(t).geometry;case"MultiPolygon":return Oe(t).geometry;default:throw Error(r+" is invalid")}},point:G,points:function(r,t,n){return n===void 0&&(n={}),V(r.map(function(e){return G(e,t)}),n)},polygon:ge,polygons:function(r,t,n){return n===void 0&&(n={}),V(r.map(function(e){return ge(e,t)}),n)},lineString:R,lineStrings:function(r,t,n){return n===void 0&&(n={}),V(r.map(function(e){return R(e,t)}),n)},featureCollection:V,multiLineString:Fe,multiPoint:Vt,multiPolygon:Oe,geometryCollection:function(r,t,n){return n===void 0&&(n={}),U({type:"GeometryCollection",geometries:r},t,n)},round:function(r,t){if(t===void 0&&(t=0),t&&t<0)throw Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(r*n)/n},radiansToLength:ot,lengthToRadians:We,lengthToDegrees:Qt,bearingToAzimuth:function(r){var t=r%360;return 0>t&&(t+=360),t},radiansToDegrees:me,degreesToRadians:T,convertLength:ze,convertArea:function(r,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),r<0)throw Error("area must be a positive number");var e=st[t];if(!e)throw Error("invalid original units");var i=st[n];if(!i)throw Error("invalid final units");return r/e*i},isNumber:je,isObject:Ae,validateBBox:function(r){if(!r)throw Error("bbox is required");if(!Array.isArray(r))throw Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(t){if(!je(t))throw Error("bbox must only contain numbers")})},validateId:function(r){if(!r)throw Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw Error("id must be a number or a string")}});function re(r,t,n){if(r!==null)for(var e,i,s,o,a,l,u,c,h=0,p=0,f=r.type,v=f==="FeatureCollection",g=f==="Feature",d=v?r.features.length:1,y=0;d>y;y++){a=(c=!!(u=v?r.features[y].geometry:g?r.geometry:r)&&u.type==="GeometryCollection")?u.geometries.length:1;for(var w=0;a>w;w++){var b=0,E=0;if((o=c?u.geometries[w]:u)!==null){l=o.coordinates;var O=o.type;switch(h=!n||O!=="Polygon"&&O!=="MultiPolygon"?0:1,O){case null:break;case"Point":if(t(l,p,y,b,E)===!1)return!1;p++,b++;break;case"LineString":case"MultiPoint":for(e=0;l.length>e;e++){if(t(l[e],p,y,b,E)===!1)return!1;p++,O==="MultiPoint"&&b++}O==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(e=0;l.length>e;e++){for(i=0;l[e].length-h>i;i++){if(t(l[e][i],p,y,b,E)===!1)return!1;p++}O==="MultiLineString"&&b++,O==="Polygon"&&E++}O==="Polygon"&&b++;break;case"MultiPolygon":for(e=0;l.length>e;e++){for(E=0,i=0;l[e].length>i;i++){for(s=0;l[e][i].length-h>s;s++){if(t(l[e][i][s],p,y,b,E)===!1)return!1;p++}E++}b++}break;case"GeometryCollection":for(e=0;o.geometries.length>e;e++)if(re(o.geometries[e],t,n)===!1)return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function Kt(r,t){var n;switch(r.type){case"FeatureCollection":for(n=0;r.features.length>n&&t(r.features[n].properties,n)!==!1;n++);break;case"Feature":t(r.properties,0)}}function ye(r,t){if(r.type==="Feature")t(r,0);else if(r.type==="FeatureCollection")for(var n=0;r.features.length>n&&t(r.features[n],n)!==!1;n++);}function Ht(r,t,n){var e=n;return ye(r,function(i,s){e=s===0&&n===void 0?i:t(e,i,s)}),e}function at(r,t){var n,e,i,s,o,a,l,u,c,h,p=0,f=r.type==="FeatureCollection",v=r.type==="Feature",g=f?r.features.length:1;for(n=0;g>n;n++){for(u=f?r.features[n].properties:v?r.properties:{},c=f?r.features[n].bbox:v?r.bbox:void 0,h=f?r.features[n].id:v?r.id:void 0,o=(l=!!(a=f?r.features[n].geometry:v?r.geometry:r)&&a.type==="GeometryCollection")?a.geometries.length:1,i=0;o>i;i++)if((s=l?a.geometries[i]:a)!==null)switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(t(s,p,u,c,h)===!1)return!1;break;case"GeometryCollection":for(e=0;s.geometries.length>e;e++)if(t(s.geometries[e],p,u,c,h)===!1)return!1;break;default:throw Error("Unknown Geometry Type")}else if(t(null,p,u,c,h)===!1)return!1;p++}}function Zt(r,t,n){var e=n;return at(r,function(i,s,o,a,l){e=s===0&&n===void 0?i:t(e,i,s,o,a,l)}),e}function ee(r,t){at(r,function(n,e,i,s,o){var a,l=n===null?null:n.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return t(U(n,i,{bbox:s,id:o}),e,0)!==!1&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;n.coordinates.length>u;u++)if(t(U({type:a,coordinates:n.coordinates[u]},i),e,u)===!1)return!1})}function lt(r,t){ee(r,function(n,e,i){var s=0;if(n.geometry){var o=n.geometry.type;if(o!=="Point"&&o!=="MultiPoint"){var a,l=0,u=0,c=0;return re(n,function(h,p,f,v,g){if(a===void 0||e>l||v>u||g>c)return a=h,l=e,u=v,c=g,void(s=0);var d=R([a,h],n.properties);if(t(d,e,i,g,s)===!1)return!1;s++,a=h})!==!1&&void 0}}})}function qt(r,t,n){var e=n,i=!1;return lt(r,function(s,o,a,l,u){e=i===!1&&n===void 0?s:t(e,s,o,a,l,u),i=!0}),e}function $t(r,t){if(!r)throw Error("geojson is required");ee(r,function(n,e,i){if(n.geometry!==null){var s=n.geometry.coordinates;switch(n.geometry.type){case"LineString":if(t(n,e,i,0,0)===!1)return!1;break;case"Polygon":for(var o=0;s.length>o;o++)if(t(R(s[o],n.properties),e,i,o)===!1)return!1}}})}var ri=Object.freeze({__proto__:null,coordAll:function(r){var t=[];return re(r,function(n){t.push(n)}),t},coordEach:re,coordReduce:function(r,t,n,e){var i=n;return re(r,function(s,o,a,l,u){i=o===0&&n===void 0?s:t(i,s,o,a,l,u)},e),i},featureEach:ye,featureReduce:Ht,findPoint:function(r,t){if(!Ae(t=t||{}))throw Error("options is invalid");var n,e=t.featureIndex||0,i=t.multiFeatureIndex||0,s=t.geometryIndex||0,o=t.coordIndex||0,a=t.properties;switch(r.type){case"FeatureCollection":0>e&&(e=r.features.length+e),a=a||r.features[e].properties,n=r.features[e].geometry;break;case"Feature":a=a||r.properties,n=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=r;break;default:throw Error("geojson is invalid")}if(n===null)return null;var l=n.coordinates;switch(n.type){case"Point":return G(l,a,t);case"MultiPoint":return 0>i&&(i=l.length+i),G(l[i],a,t);case"LineString":return 0>o&&(o=l.length+o),G(l[o],a,t);case"Polygon":return 0>s&&(s=l.length+s),0>o&&(o=l[s].length+o),G(l[s][o],a,t);case"MultiLineString":return 0>i&&(i=l.length+i),0>o&&(o=l[i].length+o),G(l[i][o],a,t);case"MultiPolygon":return 0>i&&(i=l.length+i),0>s&&(s=l[i].length+s),0>o&&(o=l[i][s].length-o),G(l[i][s][o],a,t)}throw Error("geojson is invalid")},findSegment:function(r,t){if(!Ae(t=t||{}))throw Error("options is invalid");var n,e=t.featureIndex||0,i=t.multiFeatureIndex||0,s=t.geometryIndex||0,o=t.segmentIndex||0,a=t.properties;switch(r.type){case"FeatureCollection":0>e&&(e=r.features.length+e),a=a||r.features[e].properties,n=r.features[e].geometry;break;case"Feature":a=a||r.properties,n=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=r;break;default:throw Error("geojson is invalid")}if(n===null)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return 0>o&&(o=l.length+o-1),R([l[o],l[o+1]],a,t);case"Polygon":return 0>s&&(s=l.length+s),0>o&&(o=l[s].length+o-1),R([l[s][o],l[s][o+1]],a,t);case"MultiLineString":return 0>i&&(i=l.length+i),0>o&&(o=l[i].length+o-1),R([l[i][o],l[i][o+1]],a,t);case"MultiPolygon":return 0>i&&(i=l.length+i),0>s&&(s=l[i].length+s),0>o&&(o=l[i][s].length-o-1),R([l[i][s][o],l[i][s][o+1]],a,t)}throw Error("geojson is invalid")},flattenEach:ee,flattenReduce:function(r,t,n){var e=n;return ee(r,function(i,s,o){e=s===0&&o===0&&n===void 0?i:t(e,i,s,o)}),e},geomEach:at,geomReduce:Zt,lineEach:$t,lineReduce:function(r,t,n){var e=n;return $t(r,function(i,s,o,a){e=s===0&&n===void 0?i:t(e,i,s,o,a)}),e},propEach:Kt,propReduce:function(r,t,n){var e=n;return Kt(r,function(i,s){e=s===0&&n===void 0?i:t(e,i,s)}),e},segmentEach:lt,segmentReduce:qt});function se(r){var t=[1/0,1/0,-1/0,-1/0];return re(r,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),n[0]>t[2]&&(t[2]=n[0]),n[1]>t[3]&&(t[3]=n[1])}),t}se.default=se;var si=Object.freeze({__proto__:null,default:se});function F(r){if(!r)throw Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw Error("coord must be GeoJSON Point or an Array of numbers")}function Q(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function en(r,t,n){if(!r)throw Error("No feature passed");if(!n)throw Error(".featureOf() requires a name");if(!r||r.type!=="Feature"||!r.geometry)throw Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==t)throw Error("Invalid input to "+n+": must be a "+t+", given "+r.geometry.type)}function K(r){return r.type==="Feature"?r.geometry:r}function ut(r,t){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ue(r){if(r.__esModule)return r;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(n){var e=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,e.get?e:{enumerable:!0,get:function(){return r[n]}})}),t}function te(r,t,n){if(n===void 0&&(n={}),!r)throw Error("point is required");if(!t)throw Error("polygon is required");var e=F(r),i=K(t),s=i.type,o=t.bbox,a=i.coordinates;if(o&&function(p,f){return!(f[0]>p[0]||f[1]>p[1]||p[0]>f[2]||p[1]>f[3])}(e,o)===!1)return!1;s==="Polygon"&&(a=[a]);for(var l=!1,u=0;a.length>u&&!l;u++)if(tn(e,a[u][0],n.ignoreBoundary)){for(var c=!1,h=1;a[u].length>h&&!c;)tn(e,a[u][h],!n.ignoreBoundary)&&(c=!0),h++;c||(l=!0)}return l}function tn(r,t,n){var e=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,s=t.length-1;t.length>i;s=i++){var o=t[i][0],a=t[i][1],l=t[s][0],u=t[s][1];if(r[1]*(o-l)+a*(l-r[0])+u*(r[0]-o)==0&&0>=(o-r[0])*(l-r[0])&&0>=(a-r[1])*(u-r[1]))return!n;a>r[1]!=u>r[1]&&(l-o)*(r[1]-a)/(u-a)+o>r[0]&&(e=!e)}return e}function H(r,t,n){n===void 0&&(n={});var e=F(r),i=F(t),s=T(i[1]-e[1]),o=T(i[0]-e[0]),a=T(e[1]),l=T(i[1]),u=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(l);return ot(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),n.units)}function nn(r){if(!r)throw Error("geojson is required");switch(r.type){case"Feature":return rn(r);case"FeatureCollection":return function(t){var n={type:"FeatureCollection"};return Object.keys(t).forEach(function(e){switch(e){case"type":case"features":return;default:n[e]=t[e]}}),n.features=t.features.map(function(e){return rn(e)}),n}(r);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ct(r);default:throw Error("unknown GeoJSON type")}}function rn(r){var t={type:"Feature"};return Object.keys(r).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:t[n]=r[n]}}),t.properties=sn(r.properties),t.geometry=ct(r.geometry),t}function sn(r){var t={};return r&&Object.keys(r).forEach(function(n){var e=r[n];t[n]=typeof e=="object"?e===null?null:Array.isArray(e)?e.map(function(i){return i}):sn(e):e}),t}function ct(r){var t={type:r.type};return r.bbox&&(t.bbox=r.bbox),r.type==="GeometryCollection"?(t.geometries=r.geometries.map(function(n){return ct(n)}),t):(t.coordinates=on(r.coordinates),t)}function on(r){var t=r;return typeof t[0]!="object"?t.slice():t.map(function(n){return on(n)})}function ht(r,t,n,e){e===void 0&&(e={});var i=F(r),s=T(i[0]),o=T(i[1]),a=T(n),l=We(t,e.units),u=Math.asin(Math.sin(o)*Math.cos(l)+Math.cos(o)*Math.sin(l)*Math.cos(a));return G([me(s+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(o),Math.cos(l)-Math.sin(o)*Math.sin(u))),me(u)],e.properties)}function pt(r,t,n){if(n===void 0&&(n={}),n.final===!0)return function(u,c){var h=pt(c,u);return h=(h+180)%360}(r,t);var e=F(r),i=F(t),s=T(e[0]),o=T(i[0]),a=T(e[1]),l=T(i[1]);return me(Math.atan2(Math.sin(o-s)*Math.cos(l),Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(o-s)))}function vt(r){if(!r)throw Error("geojson is required");var t=[];return ee(r,function(n){(function(e,i){var s=[],o=e.geometry;if(o!==null){switch(o.type){case"Polygon":s=Q(o);break;case"LineString":s=[Q(o)]}s.forEach(function(a){var l=function(u,c){var h=[];return u.reduce(function(p,f){var v,g,d,y,w,b,E=R([p,f],c);return E.bbox=[(w=(g=f)[0])>(d=(v=p)[0])?d:w,(b=g[1])>(y=v[1])?y:b,d>w?d:w,y>b?y:b],h.push(E),f}),h}(a,e.properties);l.forEach(function(u){u.id=i.length,i.push(u)})})}})(n,t)}),V(t)}function oi(r,t,n,e,i){an(r,t,n||0,e||r.length-1,i||ai)}function an(r,t,n,e,i){for(;e>n;){if(e-n>600){var s=e-n+1,o=t-n+1,a=Math.log(s),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(s-l)/s)*(0>o-s/2?-1:1);an(r,t,Math.max(n,Math.floor(t-o*l/s+u)),Math.min(e,Math.floor(t+(s-o)*l/s+u)),i)}var c=r[t],h=n,p=e;for(Se(r,n,t),i(r[e],c)>0&&Se(r,n,e);p>h;){for(Se(r,h,p),h++,p--;0>i(r[h],c);)h++;for(;i(r[p],c)>0;)p--}i(r[n],c)===0?Se(r,n,p):Se(r,++p,e),p>t||(n=p+1),t>p||(e=p-1)}}function Se(r,t,n){var e=r[t];r[t]=r[n],r[n]=e}function ai(r,t){return t>r?-1:r>t?1:0}function li(r,t,n){if(!n)return t.indexOf(r);for(let e=0;t.length>e;e++)if(n(r,t[e]))return e;return-1}function be(r,t){Pe(r,0,r.children.length,t,r)}function Pe(r,t,n,e,i){i||(i=we(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;n>s;s++){const o=r.children[s];Be(i,r.leaf?e(o):o)}return i}function Be(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function ui(r,t){return r.minX-t.minX}function ci(r,t){return r.minY-t.minY}function ft(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Ye(r){return r.maxX-r.minX+(r.maxY-r.minY)}function hi(r,t){const n=Math.max(r.minX,t.minX),e=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,s-e)}function gt(r,t){return!(r.minX>t.minX||r.minY>t.minY||t.maxX>r.maxX||t.maxY>r.maxY)}function Je(r,t){return!(t.minX>r.maxX||t.minY>r.maxY||r.minX>t.maxX||r.minY>t.maxY)}function we(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ln(r,t,n,e,i){const s=[t,n];for(;s.length;){if(e>=(n=s.pop())-(t=s.pop()))continue;const o=t+Math.ceil((n-t)/e/2)*e;oi(r,o,t,n,i),s.push(t,o,o,n)}}var pi=Object.freeze({__proto__:null,default:class{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(r){let t=this.data;const n=[];if(!Je(r,t))return n;const e=this.toBBox,i=[];for(;t;){for(let s=0;t.children.length>s;s++){const o=t.children[s],a=t.leaf?e(o):o;Je(r,a)&&(t.leaf?n.push(o):gt(r,a)?this._all(o,n):i.push(o))}t=i.pop()}return n}collides(r){let t=this.data;if(!Je(r,t))return!1;const n=[];for(;t;){for(let e=0;t.children.length>e;e++){const i=t.children[e],s=t.leaf?this.toBBox(i):i;if(Je(r,s)){if(t.leaf||gt(r,s))return!0;n.push(i)}}t=n.pop()}return!1}load(r){if(!r||!r.length)return this;if(this._minEntries>r.length){for(let n=0;r.length>n;n++)this.insert(r[n]);return this}let t=this._build(r.slice(),0,r.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(t.height>this.data.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=we([]),this}remove(r,t){if(!r)return this;let n=this.data;const e=this.toBBox(r),i=[],s=[];let o,a,l;for(;n||i.length;){if(n||(n=i.pop(),a=i[i.length-1],o=s.pop(),l=!0),n.leaf){const u=li(r,n.children,t);if(u!==-1)return n.children.splice(u,1),i.push(n),this._condense(i),this}l||n.leaf||!gt(n,e)?a?(o++,n=a.children[o],l=!1):n=null:(i.push(n),s.push(o),o=0,a=n,n=n.children[0])}return this}toBBox(r){return r}compareMinX(r,t){return r.minX-t.minX}compareMinY(r,t){return r.minY-t.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,t){const n=[];for(;r;)r.leaf?t.push(...r.children):n.push(...r.children),r=n.pop();return t}_build(r,t,n,e){const i=n-t+1;let s,o=this._maxEntries;if(o>=i)return s=we(r.slice(t,n+1)),be(s,this.toBBox),s;e||(o=Math.ceil(i/Math.pow(o,(e=Math.ceil(Math.log(i)/Math.log(o)))-1))),s=we([]),s.leaf=!1,s.height=e;const a=Math.ceil(i/o),l=a*Math.ceil(Math.sqrt(o));ln(r,t,n,l,this.compareMinX);for(let u=t;n>=u;u+=l){const c=Math.min(u+l-1,n);ln(r,u,c,a,this.compareMinY);for(let h=u;c>=h;h+=a)s.children.push(this._build(r,h,Math.min(h+a-1,c),e-1))}return be(s,this.toBBox),s}_chooseSubtree(r,t,n,e){for(;e.push(t),!t.leaf&&e.length-1!==n;){let o,a=1/0,l=1/0;for(let u=0;t.children.length>u;u++){const c=t.children[u],h=ft(c),p=(Math.max((s=c).maxX,(i=r).maxX)-Math.min(s.minX,i.minX))*(Math.max(s.maxY,i.maxY)-Math.min(s.minY,i.minY))-h;l>p?(l=p,a=a>h?h:a,o=c):p===l&&a>h&&(a=h,o=c)}t=o||t.children[0]}var i,s;return t}_insert(r,t,n){const e=n?r:this.toBBox(r),i=[],s=this._chooseSubtree(e,this.data,t,i);for(s.children.push(r),Be(s,e);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(e,i,t)}_split(r,t){const n=r[t],e=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,e);const s=this._chooseSplitIndex(n,i,e),o=we(n.children.splice(s,n.children.length-s));o.height=n.height,o.leaf=n.leaf,be(n,this.toBBox),be(o,this.toBBox),t?r[t-1].children.push(o):this._splitRoot(n,o)}_splitRoot(r,t){this.data=we([r,t]),this.data.height=r.height+1,this.data.leaf=!1,be(this.data,this.toBBox)}_chooseSplitIndex(r,t,n){let e,i=1/0,s=1/0;for(let o=t;n-t>=o;o++){const a=Pe(r,0,o,this.toBBox),l=Pe(r,o,n,this.toBBox),u=hi(a,l),c=ft(a)+ft(l);i>u?(i=u,e=o,s=s>c?c:s):u===i&&s>c&&(s=c,e=o)}return e||n-t}_chooseSplitAxis(r,t,n){const e=r.leaf?this.compareMinX:ui,i=r.leaf?this.compareMinY:ci,s=this._allDistMargin(r,t,n,e);this._allDistMargin(r,t,n,i)>s&&r.children.sort(e)}_allDistMargin(r,t,n,e){r.children.sort(e);const i=this.toBBox,s=Pe(r,0,t,i),o=Pe(r,n-t,n,i);let a=Ye(s)+Ye(o);for(let l=t;n-t>l;l++){const u=r.children[l];Be(s,r.leaf?i(u):u),a+=Ye(s)}for(let l=n-t-1;l>=t;l--){const u=r.children[l];Be(o,r.leaf?i(u):u),a+=Ye(o)}return a}_adjustParentBBoxes(r,t,n){for(let e=n;e>=0;e--)Be(t[e],r)}_condense(r){for(let t,n=r.length-1;n>=0;n--)r[n].children.length===0?n>0?(t=r[n-1].children,t.splice(t.indexOf(r[n]),1)):this.clear():be(r[n],this.toBBox)}}}),ne=Ue(pi),vi=Ue(ii),fi=Ue(ri),Ee=Ue(si).default,gi=fi.featureEach,un=vi.featureCollection;function cn(r){var t=new ne(r);return t.insert=function(n){if(n.type!=="Feature")throw Error("invalid feature");return n.bbox=n.bbox?n.bbox:Ee(n),ne.prototype.insert.call(this,n)},t.load=function(n){var e=[];return Array.isArray(n)?n.forEach(function(i){if(i.type!=="Feature")throw Error("invalid features");i.bbox=i.bbox?i.bbox:Ee(i),e.push(i)}):gi(n,function(i){if(i.type!=="Feature")throw Error("invalid features");i.bbox=i.bbox?i.bbox:Ee(i),e.push(i)}),ne.prototype.load.call(this,e)},t.remove=function(n,e){if(n.type!=="Feature")throw Error("invalid feature");return n.bbox=n.bbox?n.bbox:Ee(n),ne.prototype.remove.call(this,n,e)},t.clear=function(){return ne.prototype.clear.call(this)},t.search=function(n){var e=ne.prototype.search.call(this,this.toBBox(n));return un(e)},t.collides=function(n){return ne.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=ne.prototype.all.call(this);return un(n)},t.toJSON=function(){return ne.prototype.toJSON.call(this)},t.fromJSON=function(n){return ne.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var e;if(n.bbox)e=n.bbox;else if(Array.isArray(n)&&n.length===4)e=n;else if(Array.isArray(n)&&n.length===6)e=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")e=Ee(n);else{if(n.type!=="FeatureCollection")throw Error("invalid geojson");e=Ee(n)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},t}var Xe=cn;function ke(r,t){var n={},e=[];if(r.type==="LineString"&&(r=U(r)),t.type==="LineString"&&(t=U(t)),r.type==="Feature"&&t.type==="Feature"&&r.geometry!==null&&t.geometry!==null&&r.geometry.type==="LineString"&&t.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var i=hn(r,t);return i&&e.push(i),V(e)}var s=Xe();return s.load(vt(t)),ye(vt(r),function(o){ye(s.search(o),function(a){var l=hn(o,a);if(l){var u=Q(l).join(",");n[u]||(n[u]=!0,e.push(l))}})}),V(e)}function hn(r,t){var n=Q(r),e=Q(t);if(n.length!==2)throw Error("<intersects> line1 must only contain 2 coordinates");if(e.length!==2)throw Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],s=n[0][1],o=n[1][0],a=n[1][1],l=e[0][0],u=e[0][1],c=e[1][0],h=e[1][1],p=(h-u)*(o-i)-(c-l)*(a-s),f=(c-l)*(s-u)-(h-u)*(i-l),v=(o-i)*(s-u)-(a-s)*(i-l);if(p===0)return null;var g=f/p,d=v/p;return 0>g||g>1||0>d||d>1?null:G([i+g*(o-i),s+g*(a-s)])}function pn(r,t,n){n===void 0&&(n={});var e=G([1/0,1/0],{dist:1/0}),i=0;return ee(r,function(s){for(var o=Q(s),a=0;o.length-1>a;a++){var l=G(o[a]);l.properties.dist=H(t,l,n);var u=G(o[a+1]);u.properties.dist=H(t,u,n);var c=H(l,u,n),h=Math.max(l.properties.dist,u.properties.dist),p=pt(l,u),f=ht(t,h,p+90,n),v=ht(t,h,p-90,n),g=ke(R([f.geometry.coordinates,v.geometry.coordinates]),R([l.geometry.coordinates,u.geometry.coordinates])),d=null;g.features.length>0&&((d=g.features[0]).properties.dist=H(t,d,n),d.properties.location=i+H(l,d,n)),e.properties.dist>l.properties.dist&&((e=l).properties.index=a,e.properties.location=i),e.properties.dist>u.properties.dist&&((e=u).properties.index=a+1,e.properties.location=i+c),d&&e.properties.dist>d.properties.dist&&((e=d).properties.index=a),i+=c}}),e}function vn(r,t,n){n===void 0&&(n={});var e=F(r),i=F(t);i[0]+=i[0]-e[0]>180?-360:e[0]-i[0]>180?360:0;var s=function(o,a,l){var u=l=l===void 0?D:Number(l),c=o[1]*Math.PI/180,h=a[1]*Math.PI/180,p=h-c,f=Math.abs(a[0]-o[0])*Math.PI/180;f>Math.PI&&(f-=2*Math.PI);var v=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),g=Math.abs(v)>1e-11?p/v:Math.cos(c);return Math.sqrt(p*p+g*g*f*f)*u}(e,i);return ze(s,"meters",n.units)}function di(r,t,n){if(n===void 0&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!r)throw Error("pt is required");if(Array.isArray(r)?r=G(r):r.type==="Point"?r=U(r):en(r,"Point","point"),!t)throw Error("line is required");Array.isArray(t)?t=R(t):t.type==="LineString"?t=U(t):en(t,"LineString","line");var e=1/0,i=r.geometry.coordinates;return lt(t,function(s){var o=function(a,l,u,c){var h=[u[0]-l[0],u[1]-l[1]],p=[a[0]-l[0],a[1]-l[1]],f=fn(p,h);if(0>=f)return dt(a,l,{method:c.method,units:"degrees"});var v=fn(h,h);if(f>=v)return dt(a,u,{method:c.method,units:"degrees"});var g=f/v,d=[l[0]+g*h[0],l[1]+g*h[1]];return dt(a,d,{method:c.method,units:"degrees"})}(i,s.geometry.coordinates[0],s.geometry.coordinates[1],n);e>o&&(e=o)}),ze(e,"degrees",n.units)}function fn(r,t){return r[0]*t[0]+r[1]*t[1]}function dt(r,t,n){return n.method==="planar"?vn(r,t,n):H(r,t,n)}Xe.default=cn;var gn=6378137;function mi(r){return Zt(r,function(t,n){return t+function(e){var i,s=0;switch(e.type){case"Polygon":return dn(e.coordinates);case"MultiPolygon":for(i=0;e.coordinates.length>i;i++)s+=dn(e.coordinates[i]);return s;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(n)},0)}function dn(r){var t=0;if(r&&r.length>0){t+=Math.abs(mn(r[0]));for(var n=1;r.length>n;n++)t-=Math.abs(mn(r[n]))}return t}function mn(r){var t,n,e,i,s,o,a=0,l=r.length;if(l>2){for(o=0;l>o;o++)o===l-2?(e=l-2,i=l-1,s=0):o===l-1?(e=l-1,i=0,s=1):(e=o,i=o+1,s=o+2),t=r[e],n=r[i],a+=(mt(r[s][0])-mt(t[0]))*Math.sin(mt(n[1]));a=a*gn*gn/2}return a}function mt(r){return r*Math.PI/180}function Me(r,t,n){n===void 0&&(n={});for(var e=F(r),i=Q(t),s=0;i.length-1>s;s++){var o=!1;if(n.ignoreEndVertices&&(s===0&&(o="start"),s===i.length-2&&(o="end"),s===0&&s+1===i.length-1&&(o="both")),yi(i[s],i[s+1],e,o,n.epsilon===void 0?null:n.epsilon))return!0}return!1}function yi(r,t,n,e,i){var s=n[0],o=n[1],a=r[0],l=r[1],u=t[0],c=t[1],h=u-a,p=c-l,f=(n[0]-a)*p-(n[1]-l)*h;if(i!==null){if(Math.abs(f)>i)return!1}else if(f!==0)return!1;return e?e==="start"?Math.abs(p)>Math.abs(h)?p>0?o>l&&c>=o:o>=c&&l>o:h>0?s>a&&u>=s:s>=u&&a>s:e==="end"?Math.abs(p)>Math.abs(h)?p>0?o>=l&&c>o:o>c&&l>=o:h>0?s>=a&&u>s:s>u&&a>=s:e==="both"&&(Math.abs(p)>Math.abs(h)?p>0?o>l&&c>o:o>c&&l>o:h>0?s>a&&u>s:s>u&&a>s):Math.abs(p)>Math.abs(h)?p>0?o>=l&&c>=o:o>=c&&l>=o:h>0?s>=a&&u>=s:s>=u&&a>=s}function bi(r,t){t===void 0&&(t={});var n=t.precision,e=t.coordinates,i=t.mutate;if(n=n==null||isNaN(n)?6:n,e=e==null||isNaN(e)?3:e,!r)throw Error("<geojson> is required");if(typeof n!="number")throw Error("<precision> must be a number");if(typeof e!="number")throw Error("<coordinates> must be a number");i!==!1&&i!==void 0||(r=JSON.parse(JSON.stringify(r)));var s=Math.pow(10,n);return re(r,function(o){(function(a,l,u){a.length>u&&a.splice(u,a.length);for(var c=0;a.length>c;c++)a[c]=Math.round(a[c]*l)/l})(o,s,e)}),r}function yn(r,t){var n=[],e=Xe();return ee(t,function(i){if(n.forEach(function(a,l){a.id=l}),n.length){var s=e.search(i);if(s.features.length){var o=bn(i,s);n=n.filter(function(a){return a.id!==o.id}),e.remove(o),ye(yt(o,i),function(a){n.push(a),e.insert(a)})}}else(n=yt(r,i).features).forEach(function(a){a.bbox||(a.bbox=function(l){var u=l[0],c=l[1],h=l[2],p=l[3],f=H(l.slice(0,2),[h,c]);if(H(l.slice(0,2),[u,p])>f){var v=(u+h)/2;return[v-(p-c)/2,c,v+(p-c)/2,p]}var g=(c+p)/2;return[u,g-(h-u)/2,h,g+(h-u)/2]}(se(a)))}),e.load(V(n))}),V(n)}function yt(r,t){var n=[],e=Q(r)[0],i=Q(r)[r.geometry.coordinates.length-1];if(bt(e,F(t))||bt(i,F(t)))return V([r]);var s=Xe(),o=vt(r);s.load(o);var a=s.search(t);if(!a.features.length)return V([r]);var l=bn(t,a),u=Ht(o,function(c,h,p){var f=Q(h)[1],v=F(t);return p===l.id?(c.push(v),n.push(R(c)),bt(v,f)?[v]:[v,f]):(c.push(f),c)},[e]);return u.length>1&&n.push(R(u)),V(n)}function bn(r,t){if(!t.features.length)throw Error("lines must contain features");if(t.features.length===1)return t.features[0];var n,e=1/0;return ye(t,function(i){var s=pn(i,r).properties.dist;e>s&&(n=i,e=s)}),n}function bt(r,t){return r[0]===t[0]&&r[1]===t[1]}function wt(r,t){t===void 0&&(t={});var n=K(r);switch(t.properties||r.type!=="Feature"||(t.properties=r.properties),n.type){case"Polygon":return function(e,i){i===void 0&&(i={});var s=K(e),o=s.coordinates,a=i.properties?i.properties:e.type==="Feature"?e.properties:{};return wn(o,a)}(n,t);case"MultiPolygon":return function(e,i){i===void 0&&(i={});var s=K(e),o=s.coordinates,a=i.properties?i.properties:e.type==="Feature"?e.properties:{},l=[];return o.forEach(function(u){l.push(wn(u,a))}),V(l)}(n,t);default:throw Error("invalid poly")}}function wn(r,t){return r.length>1?Fe(r,t):R(r[0],t)}function wi(r,t){var n,e,i;t===void 0&&(t={});var s=t.properties,o=(n=t.autoComplete)===null||n===void 0||n,a=(e=t.orderCoords)===null||e===void 0||e;if((i=t.mutate)!==null&&i!==void 0&&i||(r=nn(r)),r.type==="FeatureCollection"){var l=[];return r.features.forEach(function(u){l.push(Q(En(u,{},o,a)))}),Oe(l,s)}return En(r,s,o,a)}function En(r,t,n,e){t=t||(r.type==="Feature"?r.properties:{});var i=K(r),s=i.coordinates,o=i.type;if(!s.length)throw Error("line must contain coordinates");switch(o){case"LineString":return n&&(s=kn(s)),ge([s],t);case"MultiLineString":var a=[],l=0;return s.forEach(function(u){if(n&&(u=kn(u)),e){var c=function(h){var p=h[0],f=h[1],v=h[2],g=h[3];return Math.abs(p-v)*Math.abs(f-g)}(se(R(u)));c>l?(a.unshift(u),l=c):a.push(u)}else a.push(u)}),ge(a,t);default:throw Error("geometry type "+o+" is not supported")}}function kn(r){var t=r[0],n=r[r.length-1];return t[0]===n[0]&&t[1]===n[1]||r.push(t),r}function Mn(r,t){var n=T(r[1]),e=T(t[1]),i=T(t[0]-r[0]);return i>Math.PI&&(i-=2*Math.PI),-Math.PI>i&&(i+=2*Math.PI),(me(Math.atan2(i,Math.log(Math.tan(e/2+Math.PI/4)/Math.tan(n/2+Math.PI/4))))+360)%360}function Ei(r,t,n,e){e===void 0&&(e={});var i=0>t,s=ze(Math.abs(t),e.units,"meters");i&&(s=-Math.abs(s));var o=F(r),a=function(l,u,c,h){h=h===void 0?D:Number(h);var p=u/h,f=l[0]*Math.PI/180,v=T(l[1]),g=T(c),d=p*Math.cos(g),y=v+d;Math.abs(y)>Math.PI/2&&(y=y>0?Math.PI-y:-Math.PI-y);var w=Math.log(Math.tan(y/2+Math.PI/4)/Math.tan(v/2+Math.PI/4)),b=Math.abs(w)>1e-11?d/w:Math.cos(v);return[(180*(f+p*Math.sin(g)/b)/Math.PI+540)%360-180,180*y/Math.PI]}(o,s,n);return a[0]+=a[0]-o[0]>180?-360:o[0]-a[0]>180?360:0,G(a,e.properties)}function Ve(r){var t=r[0],n=r[1];return[n[0]-t[0],n[1]-t[1]]}function Et(r,t){return r[0]*t[1]-t[0]*r[1]}function ki(r,t){return!function(n,e){return Et(Ve(n),Ve(e))===0}(r,t)&&function(n,e){var i,s,o=n[0],a=Ve(n),l=e[0],u=Ve(e),c=Et(a,u),h=function(p,f){return[p[0]+f[0],p[1]+f[1]]}(o,function(p,f){return[p*f[0],p*f[1]]}(Et([(i=l)[0]-(s=o)[0],i[1]-s[1]],u)/c,a));return h}(r,t)}function Ln(r,t,n){if(!Ae(n=n||{}))throw Error("options is invalid");var e=n.units;if(!r)throw Error("geojson is required");if(t==null||isNaN(t))throw Error("distance is required");var i=ut(r),s=r.properties;switch(i){case"LineString":return xn(r,t,e);case"MultiLineString":var o=[];return ee(r,function(a){o.push(xn(a,t,e).geometry.coordinates)}),Fe(o,s);default:throw Error("geometry "+i+" is not supported")}}function xn(r,t,n){var e=[],i=Qt(t,n),s=Q(r),o=[];return s.forEach(function(a,l){if(l!==s.length-1){var u=[[(p=a)[0]+(v=i)*((f=s[l+1])[1]-p[1])/(g=Math.sqrt((p[0]-f[0])*(p[0]-f[0])+(p[1]-f[1])*(p[1]-f[1]))),p[1]+v*(p[0]-f[0])/g],[f[0]+v*(f[1]-p[1])/g,f[1]+v*(p[0]-f[0])/g]];if(e.push(u),l>0){var c=e[l-1],h=ki(u,c);h!==!1&&(c[1]=h,u[0]=h),o.push(c[0]),l===s.length-2&&(o.push(u[0]),o.push(u[1]))}s.length===2&&(o.push(u[0]),o.push(u[1]))}var p,f,v,g}),R(o,r.properties)}function kt(r,t){var n=!0;return ee(r,function(e){ee(t,function(i){if(n===!1)return!1;n=function(s,o){switch(s.type){case"Point":switch(o.type){case"Point":return!((a=s.coordinates)[0]===(l=o.coordinates)[0]&&a[1]===l[1]);case"LineString":return!On(o,s);case"Polygon":return!te(s,o)}break;case"LineString":switch(o.type){case"Point":return!On(s,o);case"LineString":return!function(u,c){return ke(u,c).features.length>0}(s,o);case"Polygon":return!An(o,s)}break;case"Polygon":switch(o.type){case"Point":return!te(o,s);case"LineString":return!An(s,o);case"Polygon":return!function(u,c){for(var h=0,p=u.coordinates[0];p.length>h;h++)if(te(p[h],c))return!0;for(var f=0,v=c.coordinates[0];v.length>f;f++)if(te(v[f],u))return!0;var g=ke(wt(u),wt(c));return g.features.length>0}(o,s)}}var a,l;return!1}(e.geometry,i.geometry)})}),n}function On(r,t){for(var n=0;r.coordinates.length-1>n;n++)if(Mi(r.coordinates[n],r.coordinates[n+1],t.coordinates))return!0;return!1}function An(r,t){for(var n=0,e=t.coordinates;e.length>n;n++)if(te(e[n],r))return!0;return ke(t,wt(r)).features.length>0}function Mi(r,t,n){var e=t[0]-r[0],i=t[1]-r[1];return(n[0]-r[0])*i-(n[1]-r[1])*e==0&&(Math.abs(i)>Math.abs(e)?i>0?n[1]>=r[1]&&t[1]>=n[1]:n[1]>=t[1]&&r[1]>=n[1]:e>0?n[0]>=r[0]&&t[0]>=n[0]:n[0]>=t[0]&&r[0]>=n[0])}function Li(r,t){var n=K(r),e=K(t),i=n.type,s=e.type,o=n.coordinates,a=e.coordinates;switch(i){case"Point":if(s==="Point")return Mt(o,a);throw Error("feature2 "+s+" geometry not supported");case"MultiPoint":switch(s){case"Point":return function(l,u){var c,h=!1;for(c=0;l.coordinates.length>c;c++)if(Mt(l.coordinates[c],u.coordinates)){h=!0;break}return h}(n,e);case"MultiPoint":return function(l,u){for(var c=0,h=u.coordinates;h.length>c;c++){for(var p=h[c],f=!1,v=0,g=l.coordinates;g.length>v;v++)if(Mt(p,g[v])){f=!0;break}if(!f)return!1}return!0}(n,e);default:throw Error("feature2 "+s+" geometry not supported")}case"LineString":switch(s){case"Point":return Me(e,n,{ignoreEndVertices:!0});case"LineString":return function(l,u){for(var c=!1,h=0,p=u.coordinates;p.length>h;h++){var f=p[h];if(Me({type:"Point",coordinates:f},l,{ignoreEndVertices:!0})&&(c=!0),!Me({type:"Point",coordinates:f},l,{ignoreEndVertices:!1}))return!1}return c}(n,e);case"MultiPoint":return function(l,u){for(var c=!1,h=0,p=u.coordinates;p.length>h;h++){var f=p[h];if(Me(f,l,{ignoreEndVertices:!0})&&(c=!0),!Me(f,l))return!1}return!!c}(n,e);default:throw Error("feature2 "+s+" geometry not supported")}case"Polygon":switch(s){case"Point":return te(e,n,{ignoreBoundary:!0});case"LineString":return function(l,u){var c=!1,h=0,p=se(l),f=se(u);if(!Sn(p,f))return!1;for(;u.coordinates.length-1>h;h++)if(te({type:"Point",coordinates:xi(u.coordinates[h],u.coordinates[h+1])},l,{ignoreBoundary:!0})){c=!0;break}return c}(n,e);case"Polygon":return function(l,u){if(l.type==="Feature"&&l.geometry===null||u.type==="Feature"&&u.geometry===null)return!1;var c=se(l),h=se(u);if(!Sn(c,h))return!1;for(var p=K(u).coordinates,f=0,v=p;v.length>f;f++)for(var g=0,d=v[f];d.length>g;g++)if(!te(d[g],l))return!1;return!0}(n,e);case"MultiPoint":return function(l,u){for(var c=0,h=u.coordinates;h.length>c;c++)if(!te(h[c],l,{ignoreBoundary:!0}))return!1;return!0}(n,e);default:throw Error("feature2 "+s+" geometry not supported")}default:throw Error("feature1 "+i+" geometry not supported")}}function Sn(r,t){return t[0]>=r[0]&&r[2]>=t[2]&&t[1]>=r[1]&&t[3]<=r[3]}function Mt(r,t){return r[0]===t[0]&&r[1]===t[1]}function xi(r,t){return[(r[0]+t[0])/2,(r[1]+t[1])/2]}/**
   * splaytree v3.1.2
   * Fast Splay tree for Node and browser
   *
   * @author Alexander Milevski <info@w8r.name>
   * @license MIT
   * @preserve
   *//*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function Oi(r,t){var n,e,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,e&&(i=2&c[0]?e.return:c[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,c[1])).done)return i;switch(e=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,e=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!((i=i.length>0&&i[i.length-1])||c[0]!==6&&c[0]!==2)){o=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&i[3]>c[1])){o.label=c[1];break}if(c[0]===6&&i[1]>o.label){o.label=i[1],i=c;break}if(i&&i[2]>o.label){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(r,o)}catch(h){c=[6,h],e=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([l,u])}}}var ue=function(r,t){this.next=null,this.key=r,this.data=t,this.left=null,this.right=null};function Ai(r,t){return r>t?1:t>r?-1:0}function ce(r,t,n){for(var e=new ue(null,null),i=e,s=e;;){var o=n(r,t.key);if(0>o){if(t.left===null||0>n(r,t.left.key)&&(t.left=(a=t.left).right,a.right=t,(t=a).left===null))break;s.left=t,s=t,t=t.left}else{if(0>=o||t.right===null)break;var a;if(n(r,t.right.key)>0&&(t.right=(a=t.right).left,a.left=t,(t=a).right===null))break;i.right=t,i=t,t=t.right}}return i.right=t.left,s.left=t.right,t.left=e.right,t.right=e.left,t}function Lt(r,t,n,e){var i=new ue(r,t);if(n===null)return i.left=i.right=null,i;var s=e(r,(n=ce(r,n,e)).key);return 0>s?(i.left=n.left,i.right=n,n.left=null):0>s||(i.right=n.right,i.left=n,n.right=null),i}function Pn(r,t,n){var e=null,i=null;if(t){var s=n((t=ce(r,t,n)).key,r);s===0?(e=t.left,i=t.right):0>s?(i=t.right,t.right=null,e=t):(e=t.left,t.left=null,i=t)}return{left:e,right:i}}function xt(r,t,n,e,i){if(r){e(t+(n?"└── ":"├── ")+i(r)+`
`);var s=t+(n?"    ":"│   ");r.left&&xt(r.left,s,!1,e,i),r.right&&xt(r.right,s,!0,e,i)}}var Ot=function(){function r(t){t===void 0&&(t=Ai),this._root=null,this._size=0,this._comparator=t}return r.prototype.insert=function(t,n){return this._size++,this._root=Lt(t,n,this._root,this._comparator)},r.prototype.add=function(t,n){var e=new ue(t,n);this._root===null&&(e.left=e.right=null,this._size++,this._root=e);var i=this._comparator,s=ce(t,this._root,i),o=i(t,s.key);return o===0?this._root=s:(0>o?(e.left=s.left,e.right=s,s.left=null):o>0&&(e.right=s.right,e.left=s,s.right=null),this._size++,this._root=e),this._root},r.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},r.prototype._remove=function(t,n,e){var i;return n===null?null:e(t,(n=ce(t,n,e)).key)===0?(n.left===null?i=n.right:(i=ce(t,n.left,e)).right=n.right,this._size--,i):n},r.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ce(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},r.prototype.findStatic=function(t){for(var n=this._root,e=this._comparator;n;){var i=e(t,n.key);if(i===0)return n;n=0>i?n.left:n.right}return null},r.prototype.find=function(t){return this._root&&(this._root=ce(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},r.prototype.contains=function(t){for(var n=this._root,e=this._comparator;n;){var i=e(t,n.key);if(i===0)return!0;n=0>i?n.left:n.right}return!1},r.prototype.forEach=function(t,n){for(var e=this._root,i=[],s=!1;!s;)e!==null?(i.push(e),e=e.left):i.length!==0?(e=i.pop(),t.call(n,e),e=e.right):s=!0;return this},r.prototype.range=function(t,n,e,i){for(var s=[],o=this._comparator,a=this._root;s.length!==0||a;)if(a)s.push(a),a=a.left;else{if(o((a=s.pop()).key,n)>0)break;if(o(a.key,t)>=0&&e.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var t=[];return this.forEach(function(n){return t.push(n.key)}),t},r.prototype.values=function(){var t=[];return this.forEach(function(n){return t.push(n.data)}),t},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},r.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},r.prototype.at=function(t){for(var n=this._root,e=!1,i=0,s=[];!e;)if(n)s.push(n),n=n.left;else if(s.length>0){if(n=s.pop(),i===t)return n;i++,n=n.right}else e=!0;return null},r.prototype.next=function(t){var n=this._root,e=null;if(t.right){for(e=t.right;e.left;)e=e.left;return e}for(var i=this._comparator;n;){var s=i(t.key,n.key);if(s===0)break;0>s?(e=n,n=n.left):n=n.right}return e},r.prototype.prev=function(t){var n=this._root,e=null;if(t.left!==null){for(e=t.left;e.right;)e=e.right;return e}for(var i=this._comparator;n;){var s=i(t.key,n.key);if(s===0)break;0>s?n=n.left:(e=n,n=n.right)}return e},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return function(t){for(var n=t,e=[],i=!1,s=new ue(null,null),o=s;!i;)n?(e.push(n),n=n.left):e.length>0?n=(n=o=o.next=e.pop()).right:i=!0;return o.next=null,s.next}(this._root)},r.prototype.load=function(t,n,e){n===void 0&&(n=[]),e===void 0&&(e=!1);var i=t.length,s=this._comparator;if(e&&Pt(t,n,0,i-1,s),this._root===null)this._root=At(t,n,0,i),this._size=i;else{var o=function(a,l,u){for(var c=new ue(null,null),h=c,p=a,f=l;p!==null&&f!==null;)0>u(p.key,f.key)?(h.next=p,p=p.next):(h.next=f,f=f.next),h=h.next;return p!==null?h.next=p:f!==null&&(h.next=f),c.next}(this.toList(),function(a,l){for(var u=new ue(null,null),c=u,h=0;a.length>h;h++)c=c.next=new ue(a[h],l[h]);return c.next=null,u.next}(t,n),s);this._root=St({head:o},0,i=this._size+i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){t===void 0&&(t=function(e){return e.key+""});var n=[];return xt(this._root,"",!0,function(e){return n.push(e)},t),n.join("")},r.prototype.update=function(t,n,e){var i=this._comparator,s=Pn(t,this._root,i),o=s.left,a=s.right;0>i(t,n)?a=Lt(n,e,a,i):o=Lt(n,e,o,i),this._root=function(l,u,c){return u===null?l:(l===null||((u=ce(l.key,u,c)).left=l),u)}(o,a,i)},r.prototype.split=function(t){return Pn(t,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var t,n,e;return Oi(this,function(i){switch(i.label){case 0:t=this._root,n=[],e=!1,i.label=1;case 1:return e?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:[4,t=n.pop()];case 3:return i.sent(),t=t.right,[3,5];case 4:e=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function At(r,t,n,e){var i=e-n;if(i>0){var s=n+Math.floor(i/2),o=new ue(r[s],t[s]);return o.left=At(r,t,n,s),o.right=At(r,t,s+1,e),o}return null}function St(r,t,n){var e=n-t;if(e>0){var i=t+Math.floor(e/2),s=St(r,t,i),o=r.head;return o.left=s,r.head=r.head.next,o.right=St(r,i+1,n),o}return null}function Pt(r,t,n,e,i){if(e>n){for(var s=r[n+e>>1],o=n-1,a=e+1;;){do o++;while(0>i(r[o],s));do a--;while(i(r[a],s)>0);if(o>=a)break;var l=r[o];r[o]=r[a],r[a]=l,l=t[o],t[o]=t[a],t[a]=l}Pt(r,t,n,a,i),Pt(r,t,a+1,e,i)}}function Z(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Bn(r,t){for(var n=0;t.length>n;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function W(r,t,n){return t&&Bn(r.prototype,t),n&&Bn(r,n),r}var Ge=function(r,t){return!(r.ll.x>t.x||t.x>r.ur.x||r.ll.y>t.y||t.y>r.ur.y)},Bt=function(r,t){return r.ll.x>t.ur.x||t.ll.x>r.ur.x||r.ll.y>t.ur.y||t.ll.y>r.ur.y?null:{ll:{x:t.ll.x>r.ll.x?t.ll.x:r.ll.x,y:t.ll.y>r.ll.y?t.ll.y:r.ll.y},ur:{x:t.ur.x>r.ur.x?r.ur.x:t.ur.x,y:t.ur.y>r.ur.y?r.ur.y:t.ur.y}}},he=Number.EPSILON;he===void 0&&(he=Math.pow(2,-52));var Si=he*he,Gt=function(r,t){if(r>-he&&he>r&&t>-he&&he>t)return 0;var n=r-t;return Si*r*t>n*n?0:t>r?-1:1},Pi=function(){function r(){Z(this,r),this.reset()}return W(r,[{key:"reset",value:function(){this.xRounder=new Gn,this.yRounder=new Gn}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Gn=function(){function r(){Z(this,r),this.tree=new Ot,this.round(0)}return W(r,[{key:"round",value:function(t){var n=this.tree.add(t),e=this.tree.prev(n);if(e!==null&&Gt(n.key,e.key)===0)return this.tree.remove(t),e.key;var i=this.tree.next(n);return i!==null&&Gt(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),Ie=new Pi,Ce=function(r,t){return r.x*t.y-r.y*t.x},In=function(r,t){return r.x*t.x+r.y*t.y},Cn=function(r,t,n){var e=Ce({x:t.x-r.x,y:t.y-r.y},{x:n.x-r.x,y:n.y-r.y});return Gt(e,0)},Qe=function(r){return Math.sqrt(In(r,r))},Bi=function(r,t,n){var e={x:t.x-r.x,y:t.y-r.y},i={x:n.x-r.x,y:n.y-r.y};return In(i,e)/Qe(i)/Qe(e)},Rn=function(r,t,n){return t.y===0?null:{x:r.x+t.x/t.y*(n-r.y),y:n}},Nn=function(r,t,n){return t.x===0?null:{x:n,y:r.y+t.y/t.x*(n-r.x)}},ie=function(){function r(t,n){Z(this,r),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return W(r,null,[{key:"compare",value:function(t,n){var e=r.comparePoints(t.point,n.point);return e!==0?e:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Ke.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return n.x>t.x?-1:t.x>n.x?1:n.y>t.y?-1:t.y>n.y?1:0}}]),W(r,[{key:"link",value:function(t){if(t.point===this.point)throw Error("Tried to link already linked events");for(var n=t.point.events,e=0,i=n.length;i>e;e++){var s=n[e];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;t>n;n++){var e=this.point.events[n];if(e.segment.consumedBy===void 0)for(var i=n+1;t>i;i++){var s=this.point.events[i];s.consumedBy===void 0&&e.otherSE.point.events===s.otherSE.point.events&&e.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,e=this.point.events.length;e>n;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,e=new Map,i=function(s){var o,a,l,u,c,h=s.otherSE;e.set(s,{sine:(o=n.point,a=t.point,l=h.point,u={x:a.x-o.x,y:a.y-o.y},c={x:l.x-o.x,y:l.y-o.y},Ce(c,u)/Qe(c)/Qe(u)),cosine:Bi(n.point,t.point,h.point)})};return function(s,o){e.has(s)||i(s),e.has(o)||i(o);var a=e.get(s),l=a.sine,u=a.cosine,c=e.get(o),h=c.sine,p=c.cosine;return 0>l||0>h?0>l&&0>h?p>u?-1:u>p?1:0:l>h?-1:h>l?1:0:p>u?1:u>p?-1:0}}}]),r}(),Gi=0,Ke=function(){function r(t,n,e,i){Z(this,r),this.id=++Gi,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=e,this.windings=i}return W(r,null,[{key:"compare",value:function(t,n){var e=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,o=n.rightSE.point.x;if(e>o)return 1;if(i>s)return-1;var a=t.leftSE.point.y,l=n.leftSE.point.y,u=t.rightSE.point.y,c=n.rightSE.point.y;if(i>e){if(a>l&&u>l)return 1;if(l>a&&l>u)return-1;var h=t.comparePoint(n.leftSE.point);if(0>h)return 1;if(h>0)return-1;var p=n.comparePoint(t.rightSE.point);return p!==0?p:-1}if(e>i){if(l>a&&c>a)return-1;if(a>l&&a>c)return 1;var f=n.comparePoint(t.leftSE.point);if(f!==0)return f;var v=t.comparePoint(n.rightSE.point);return 0>v?1:v>0?-1:1}if(l>a)return-1;if(a>l)return 1;if(o>s){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>o){var d=t.comparePoint(n.rightSE.point);if(0>d)return 1;if(d>0)return-1}if(s!==o){var y=u-a,w=s-e,b=c-l,E=o-i;if(y>w&&E>b)return 1;if(w>y&&b>E)return-1}return s>o?1:o>s||c>u?-1:u>c?1:n.id>t.id?-1:t.id>n.id?1:0}}]),W(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:n>t?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,e=this.rightSE.point,i=this.vector();if(n.x===e.x)return t.x===n.x?0:n.x>t.x?1:-1;if(t.x===n.x+(t.y-n.y)/i.y*i.x)return 0;var s=n.y+(t.x-n.x)/i.x*i.y;return t.y===s?0:s>t.y?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),e=t.bbox(),i=Bt(n,e);if(i===null)return null;var s=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,l=t.rightSE.point,u=Ge(n,a)&&this.comparePoint(a)===0,c=Ge(e,s)&&t.comparePoint(s)===0,h=Ge(n,l)&&this.comparePoint(l)===0,p=Ge(e,o)&&t.comparePoint(o)===0;if(c&&u)return p&&!h?o:!p&&h?l:null;if(c)return h&&s.x===l.x&&s.y===l.y?null:s;if(u)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&h)return null;if(p)return o;if(h)return l;var f=function(v,g,d,y){if(g.x===0)return Nn(d,y,v.x);if(y.x===0)return Nn(v,g,d.x);if(g.y===0)return Rn(d,y,v.y);if(y.y===0)return Rn(v,g,d.y);var w=Ce(g,y);if(w==0)return null;var b={x:d.x-v.x,y:d.y-v.y},E=Ce(b,g)/w,O=Ce(b,y)/w;return{x:(v.x+O*g.x+(d.x+E*y.x))/2,y:(v.y+O*g.y+(d.y+E*y.y))/2}}(s,this.vector(),a,t.vector());return f===null?null:Ge(i,f)?Ie.round(f.x,f.y):null}},{key:"split",value:function(t){var n=[],e=t.events!==void 0,i=new ie(t,!0),s=new ie(t,!1),o=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var a=new r(i,o,this.rings.slice(),this.windings.slice());return ie.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),ie.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),e&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,e=this.windings.length;e>n;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,e=t;n.consumedBy;)n=n.consumedBy;for(;e.consumedBy;)e=e.consumedBy;var i=r.compare(n,e);if(i!==0){if(i>0){var s=n;n=e,e=s}if(n.prev===e){var o=n;n=e,e=o}for(var a=0,l=e.rings.length;l>a;a++){var u=e.rings[a],c=e.windings[a],h=n.rings.indexOf(u);h===-1?(n.rings.push(u),n.windings.push(c)):n.windings[h]+=c}e.rings=null,e.windings=null,e.consumedBy=n,e.leftSE.consumedBy=n.leftSE,e.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return this._beforeState!==void 0?this._beforeState:(this.prev?this._beforeState=(this.prev.consumedBy||this.prev).afterState():this._beforeState={rings:[],windings:[],multiPolys:[]},this._beforeState)}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,e=this._afterState.windings,i=this._afterState.multiPolys,s=0,o=this.rings.length;o>s;s++){var a=this.rings[s],l=this.windings[s],u=n.indexOf(a);u===-1?(n.push(a),e.push(l)):e[u]+=l}for(var c=[],h=[],p=0,f=n.length;f>p;p++)if(e[p]!==0){var v=n[p],g=v.poly;if(h.indexOf(g)===-1)if(v.isExterior)c.push(g);else{h.indexOf(g)===-1&&h.push(g);var d=c.indexOf(v.poly);d!==-1&&c.splice(d,1)}}for(var y=0,w=c.length;w>y;y++){var b=c[y].multiPoly;i.indexOf(b)===-1&&i.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(oe.type){case"union":this._isInResult=t.length===0!=(n.length===0);break;case"intersection":var e,i;n.length>t.length?(e=t.length,i=n.length):(e=n.length,i=t.length),this._isInResult=i===oe.numMultiPolys&&i>e;break;case"xor":this._isInResult=Math.abs(t.length-n.length)%2==1;break;case"difference":var s=function(o){return o.length===1&&o[0].isSubject};this._isInResult=s(t)!==s(n);break;default:throw Error("Unrecognized operation type found ".concat(oe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,e){var i,s,o,a=ie.comparePoints(t,n);if(0>a)i=t,s=n,o=1;else{if(0>=a)throw Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,s=t,o=-1}return new r(new ie(i,!0),new ie(s,!1),[e],[o])}}]),r}(),Dn=function(){function r(t,n,e){if(Z(this,r),!Array.isArray(t)||t.length===0||(this.poly=n,this.isExterior=e,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number"))throw Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ie.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var s=i,o=1,a=t.length;a>o;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ie.round(t[o][0],t[o][1]);l.x===s.x&&l.y===s.y||(this.segments.push(Ke.fromRing(s,l,this)),this.bbox.ll.x>l.x&&(this.bbox.ll.x=l.x),this.bbox.ll.y>l.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),s=l)}i.x===s.x&&i.y===s.y||this.segments.push(Ke.fromRing(s,i,this))}return W(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,e=this.segments.length;e>n;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),Ii=function(){function r(t,n){if(Z(this,r),!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Dn(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var e=1,i=t.length;i>e;e++){var s=new Dn(t[e],this,!1);this.bbox.ll.x>s.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),this.bbox.ll.y>s.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=n}return W(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,e=this.interiorRings.length;e>n;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,o=i.length;o>s;s++)t.push(i[s]);return t}}]),r}(),_n=function(){function r(t,n){if(Z(this,r),!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:1/0,y:1/0},ur:{x:-1/0,y:-1/0}};for(var e=0,i=t.length;i>e;e++){var s=new Ii(t[e],this);this.bbox.ll.x>s.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),this.bbox.ll.y>s.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=n}return W(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,e=this.polys.length;e>n;n++)for(var i=this.polys[n].getSweepEvents(),s=0,o=i.length;o>s;s++)t.push(i[s]);return t}}]),r}(),Ci=function(){function r(t){Z(this,r),this.events=t;for(var n=0,e=t.length;e>n;n++)t[n].segment.ringOut=this;this.poly=null}return W(r,null,[{key:"factory",value:function(t){for(var n=[],e=0,i=t.length;i>e;e++){var s=t[e];if(s.isInResult()&&!s.ringOut){for(var o=null,a=s.leftSE,l=s.rightSE,u=[a],c=a.point,h=[];o=a,u.push(a=l),a.point!==c;)for(;;){var p=a.getAvailableLinkedEvents();if(p.length===0){var f=u[0].point,v=u[u.length-1].point;throw Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(p.length===1){l=p[0].otherSE;break}for(var g=null,d=0,y=h.length;y>d;d++)if(h[d].point===a.point){g=d;break}if(g===null){h.push({index:u.length,point:a.point});var w=a.getLeftmostComparator(o);l=p.sort(w)[0].otherSE;break}var b=h.splice(g)[0],E=u.splice(b.index);E.unshift(E[0].otherSE),n.push(new r(E.reverse()))}n.push(new r(u))}}return n}}]),W(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],e=1,i=this.events.length-1;i>e;e++){var s=this.events[e].point;Cn(s,t,this.events[e+1].point)!==0&&(n.push(s),t=s)}if(n.length===1)return null;Cn(n[0],t,n[1])===0&&n.shift(),n.push(n[0]);for(var o=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:n.length-1,l=this.isExteriorRing()?n.length:-1,u=[],c=a;c!=l;c+=o)u.push([n[c].x,n[c].y]);return u}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,e=this.events.length;e>n;n++){var i=this.events[n];ie.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),o=s?s.prevInResult():null;;){if(!s)return null;if(!o)return s.ringOut;if(o.ringOut!==s.ringOut)return o.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=o.prevInResult(),o=s?s.prevInResult():null}}}]),r}(),Tn=function(){function r(t){Z(this,r),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return W(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,e=this.interiorRings.length;e>n;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),Ri=function(){function r(t){Z(this,r),this.rings=t,this.polys=this._composePolys(t)}return W(r,[{key:"getGeom",value:function(){for(var t=[],n=0,e=this.polys.length;e>n;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],e=0,i=t.length;i>e;e++){var s=t[e];if(!s.poly)if(s.isExteriorRing())n.push(new Tn(s));else{var o=s.enclosingRing();o.poly||n.push(new Tn(o)),o.poly.addInterior(s)}}return n}}]),r}(),Ni=function(){function r(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ke.compare;Z(this,r),this.queue=t,this.tree=new Ot(n),this.segments=[]}return W(r,[{key:"process",value:function(t){var n=t.segment,e=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),e;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,o=i,a=void 0,l=void 0;a===void 0;)(s=this.tree.prev(s))===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;l===void 0;)(o=this.tree.next(o))===null?l=null:o.key.consumedBy===void 0&&(l=o.key);if(t.isLeft){var u=null;if(a){var c=a.getIntersection(n);if(c!==null&&(n.isAnEndpoint(c)||(u=c),!a.isAnEndpoint(c)))for(var h=this._splitSafely(a,c),p=0,f=h.length;f>p;p++)e.push(h[p])}var v=null;if(l){var g=l.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(v=g),!l.isAnEndpoint(g)))for(var d=this._splitSafely(l,g),y=0,w=d.length;w>y;y++)e.push(d[y])}if(u!==null||v!==null){var b=null;u===null?b=v:v===null?b=u:b=ie.comparePoints(u,v)>0?v:u,this.queue.remove(n.rightSE),e.push(n.rightSE);for(var E=n.split(b),O=0,Y=E.length;Y>O;O++)e.push(E[O])}e.length>0?(this.tree.remove(n),e.push(t)):(this.segments.push(n),n.prev=a)}else{if(a&&l){var C=a.getIntersection(l);if(C!==null){if(!a.isAnEndpoint(C))for(var z=this._splitSafely(a,C),q=0,ve=z.length;ve>q;q++)e.push(z[q]);if(!l.isAnEndpoint(C))for(var le=this._splitSafely(l,C),fe=0,Dt=le.length;Dt>fe;fe++)e.push(le[fe])}}this.tree.remove(n)}return e}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var e=t.rightSE;this.queue.remove(e);var i=t.split(n);return i.push(e),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Fn=typeof process<"u"&&de.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Di=typeof process<"u"&&de.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,oe=new(function(){function r(){Z(this,r)}return W(r,[{key:"run",value:function(t,n,e){oe.type=t,Ie.reset();for(var i=[new _n(n,!0)],s=0,o=e.length;o>s;s++)i.push(new _n(e[s],!1));if(oe.numMultiPolys=i.length,oe.type==="difference")for(var a=i[0],l=1;i.length>l;)Bt(i[l].bbox,a.bbox)!==null?l++:i.splice(l,1);if(oe.type==="intersection"){for(var u=0,c=i.length;c>u;u++)for(var h=i[u],p=u+1,f=i.length;f>p;p++)if(Bt(h.bbox,i[p].bbox)===null)return[]}for(var v=new Ot(ie.compare),g=0,d=i.length;d>g;g++)for(var y=i[g].getSweepEvents(),w=0,b=y.length;b>w;w++)if(v.insert(y[w]),v.size>Fn)throw Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var E=new Ni(v),O=v.size,Y=v.pop();Y;){var C=Y.key;if(v.size===O){var z=C.segment;throw Error("Unable to pop() ".concat(C.isLeft?"left":"right"," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat(z.id," ")+"[".concat(z.leftSE.point.x,", ").concat(z.leftSE.point.y,"] -> ")+"[".concat(z.rightSE.point.x,", ").concat(z.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>Fn)throw Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(E.segments.length>Di)throw Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var q=E.process(C),ve=0,le=q.length;le>ve;ve++){var fe=q[ve];fe.consumedBy===void 0&&v.insert(fe)}O=v.size,Y=v.pop()}Ie.reset();var Dt=Ci.factory(E.segments);return new Ri(Dt).getGeom()}}]),r}()),_i=function(r){for(var t=arguments.length,n=Array(t>1?t-1:0),e=1;t>e;e++)n[e-1]=arguments[e];return oe.run("union",r,n)},Ti=function(r){for(var t=arguments.length,n=Array(t>1?t-1:0),e=1;t>e;e++)n[e-1]=arguments[e];return oe.run("difference",r,n)};function Wn(r,t,n){n===void 0&&(n={});var e=K(r),i=K(t),s=_i(e.coordinates,i.coordinates);return s.length===0?null:s.length===1?ge(s[0],n.properties):Oe(s,n.properties)}var N={getLineCenter:function(r,t){r instanceof BMapGL.Point&&t instanceof BMapGL.Point&&(r=G([r.lng,r.lat]),t=G([t.lng,t.lat]));var n=function(e,i){return ht(e,H(e,i)/2,pt(e,i))}(r,t);return{geoCenter:n,bdCenter:new BMapGL.Point(n.geometry.coordinates[0],n.geometry.coordinates[1])}},getDistance:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers";return r instanceof BMapGL.Point&&t instanceof BMapGL.Point&&(r=G([r.lng,r.lat]),t=G([t.lng,t.lat])),H(r,t,{units:n})},getLength:function(r){var t;return(t={units:arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kilometers"})===void 0&&(t={}),qt(r,function(n,e){var i=e.geometry.coordinates;return n+H(i[0],i[1],t)},0)},getPolygonCenter:function(r){var t=function(n,e){e===void 0&&(e={});var i=0,s=0,o=0;return re(n,function(a){i+=a[0],s+=a[1],o++},!0),G([i/o,s/o],e.properties)}(r);return{geoCenter:t,bdCenter:new BMapGL.Point(t.geometry.coordinates[0],t.geometry.coordinates[1])}},getPolygonArea:function(r){return r instanceof BMapGL.Polygon&&(r=r.toGeoJSON()),mi(r)/1e6},unionPolygon:function(r){for(var t=r[0],n=0,e=r.length;e>n;n++)t=Wn(t,r[n]);return t},isDisjoint:function(r,t){return!kt(r,t)},intersect:function(r,t){var n=[];if(t.__proto__ instanceof BMapGL.Overlay){if(!t.toGeoJSON)return n;t=t.toGeoJSON()}return r.forEach(function(e){var i=e;if(e.__proto__ instanceof BMapGL.Overlay){if(!e.toGeoJSON)return!0;i=e.toGeoJSON()}N.isDisjoint(i,t)&&n.push(e)}),n},isContains:function(r,t){return Li(r,t)},isPointOnLine:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreEndVertices:!1};return r instanceof BMapGL.Point&&(r=r.toGeoJSON()),t instanceof BMapGL.Polyline&&(t=t.toGeoJSON()),Me(r,t,n)},isPointInPolygon:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreBoundary:!0};return r instanceof BMapGL.Point&&(r=r.toGeoJSON()),t instanceof BMapGL.Polygon&&(t=t.toGeoJSON()),te(r,t,n)},getDistance2Lines:function(r,t){return di(G([r.lng,r.lat]),R(t))},getNearestPointOnLine:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers",e=G([r.lng,r.lat]),i=[];t.geometry.type==="Polygon"?i=t.geometry.coordinates[0]:t.geometry.type==="LineString"&&(i=t.geometry.coordinates);var s=pn(R(i),e,n),o=new BMapGL.Point(s.geometry.coordinates[0],s.geometry.coordinates[1]);return{geoPoint:e,geoNearestPoint:s,toLineDistance:H(e,s),bdNearestPoint:o}}},Fi=function(r){S(n,r);var t=P(n);function n(e){var i;return L(this,n),(i=t.call(this)).point=void 0,i.overlay=void 0,i.map=e,i}return x(n,[{key:"confirmOperate",value:function(){var e=""+this.overlay;e==="Polyline"||e==="Polygon"?this.overlay.disableEditing():e==="Marker"&&this.overlay.disableDragging(),this.dispatchEvent(new A("ok",this.overlay))}},{key:"cancelOperate",value:function(){this.dispatchEvent(new A("cancel",this.overlay))}},{key:"setPosition",value:function(e,i){this.point=e;var s=this.map.pointToOverlayPixel(this.point);i?(this.div.classList.remove("operateLeft"),this.div.style.left=s.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=s.x-105+"px"),this.div.style.top=s.y-16+"px"}},{key:"draw",value:function(){var e=this.map.pointToOverlayPixel(this.point);this.div.style.left=e.x+15+"px",this.div.style.top=e.y-16+"px"}},{key:"calculateOverlay",value:function(){var e={data:0};switch(""+this.overlay){case"Polyline":e.data=1e3*N.getLength(this.overlay.toGeoJSON());break;case"Polygon":e.data=1e6*N.getPolygonArea(this.overlay);break;case"Circle":var i=this.overlay.getRadius();e.data=Math.PI*i*i}return e.data=!e.data||0>e.data?0:e.data.toFixed(2),e}}]),n}(nt(BMapGL.Overlay,j)),Re=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this,e)).limit=void 0,s.element=i,s}return x(n,[{key:"setData",value:function(e){for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.type=""+this.overlay,this.type==="Marker"?(this.overlayTypeText="可以拖动图标改变位置",this.unit=this.type==="Polyline"?"万米":"万平方米"):this.overlayTypeText=this.type==="Polyline"?"长度不超过"+(this.limit||1e10)/1e4+"万米！":"面积不超过"+(this.limit||1e10)/1e4+"万平方米！"}},{key:"initialize",value:function(e){var i;return this.element?(i=this.div=this.element).className="operateWindow":((i=this.div=document.createElement("div")).className="operateWindow",i.innerHTML=`<div class="containerbox">
                <span id="confirmOperate"></span>
                <span id="cancelOperate"></span>
                <span id="warnOperate">`.concat(this.overlayTypeText,`</span>
                </div>`)),e.getPanes().markerPane.appendChild(this.div),this.bind(),this.updateWindow(),i}},{key:"bind",value:function(){var e=this;if(this.element)throw console.log("自定义operate必须重写bind方法"),{errMsg:"自定义operate必须重写bind方法"};document.getElementById("confirmOperate").addEventListener("click",function(i){var s=e.calculateOverlay();e.overlay.geometryCalculate=s,e.confirmOperate()}),document.getElementById("cancelOperate").addEventListener("click",function(i){e.cancelOperate()})}},{key:"updateWindow",value:function(){if(this.element)throw console.log("自定义operate必须重写updateWindow方法"),{errMsg:"自定义operate必须重写updateWindow方法"};var e=this.limit||1e7,i=this.calculateOverlay();document.getElementById("confirmOperate")&&(i.data>~~e?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none"))}}]),n}(Fi),zn=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this))._enableEdgeMove=!1,s.cursor="crosshair",s.container=void 0,s.map=e,i&&(s.cursor=i),s}return x(n,[{key:"initialize",value:function(e){var i=this;this.dispose();var s=e.getSize(),o=this.container=document.createElement("div");return o.style.cssText=`position:absolute;background:transparent;
            cursor:`.concat(this.cursor,";width:").concat(s.width,"px;height:").concat(s.height,"px"),e.addEventListener("resize",function(a){i.adjustSize(a.size)}),e.getPanes().floatPane.appendChild(o),this.bindEvent(),o}},{key:"draw",value:function(){var e=this.map.pixelToPoint(new BMapGL.Pixel(0,0)),i=this.map.pointToOverlayPixel(e);this.container.style.left=i.x+"px",this.container.style.top=i.y+"px"}},{key:"setCursor",value:function(e){this.cursor=e,this.container&&(this.container.style.cursor=e)}},{key:"adjustSize",value:function(e){this.container.style.width=e.width+"px",this.container.style.height=e.height+"px"}},{key:"bindEvent",value:function(){for(var e=this,i=null,s=null,o=function(c){return{x:c.clientX,y:c.clientY}},a=function(c){var h=c.type,p=e.getDrawLatlngPoint(c),f=function(g){c.point=p,e.dispatchEvent(c)};h==="mousedown"&&(i=o(c));var v=o(c);h==="click"?5>Math.abs(v.x-i.x)&&5>Math.abs(v.y-i.y)&&(s&&5>Math.abs(v.x-s.x)&&5>Math.abs(v.y-s.y)?s=null:(f(),s=o(c))):f()},l=["click","mousedown","mousemove","mouseup","dblclick","rightclick"],u=l.length;u--;)m.on(this.container,l[u],a,this._listeners);m.on(this.container,"mousemove",function(c){e._enableEdgeMove&&e.mousemoveAction(c)},this._listeners)}},{key:"mousemoveAction",value:function(e){var i=this,s=this.map.pointToPixel(this.getDrawLatlngPoint(e)),o=function(a){var l=a.clientX,u=a.clientY;return a.changedTouches&&(l=a.changedTouches[0].clientX,u=a.changedTouches[0].clientY),new BMapGL.Pixel(l,u)}(e);s=new BMapGL.Pixel(o.x-(o.x-s.x),o.y-(o.y-s.y)),this.draggingMovePixel=s,this.panByX=this.panByY=0,s.x>=4&&20>=s.x||s.x>=this.map.width-20&&this.map.width-4>=s.x||s.y>=4&&50>=s.y||s.y>=this.map.height-10&&this.map.height-4>=s.y?(s.x>20?this.map.width-20>s.x||(this.panByX=-8):this.panByX=8,s.y>50?this.map.height-10>s.y||(this.panByY=-8):this.panByY=8,this.edgeMoveTimer||(this.edgeMoveTimer=setInterval(function(){i.map.panBy(i.panByX,i.panByY,{noAnimation:!0})},30))):this.edgeMoveTimer&&(clearInterval(this.edgeMoveTimer),this.edgeMoveTimer=null)}},{key:"getDrawLatlngPoint",value:function(e){var i=m.getTarget(e),s=e.offsetX||e.layerX||0,o=e.offsetY||e.layerY||0;for(i.nodeType!==1&&(i=i.parentNode);i&&i!==this.map.getContainer();)i.clientWidth===0&&i.clientHeight===0&&i.offsetParent&&i.offsetParent.nodeName==="TD"||(s+=i.offsetLeft||0,o+=i.offsetTop||0),i=i.offsetParent;var a=new BMapGL.Pixel(s,o);return this.map.pixelToPoint(a)}},{key:"enableEdgeMove",value:function(){this._enableEdgeMove=!0}},{key:"disableEdgeMove",value:function(){clearInterval(this.edgeMoveTimer),this._enableEdgeMove=!1}}]),n}(nt(BMapGL.Overlay,j)),He=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(L(this,n),(i=t.call(this)).isOpen=void 0,i.drawType=void 0,i.instances=[],i.selectInstance=[],i.mask=void 0,i.map=void 0,i.operate=void 0,i._currentStatus=I.STATUS_FREE,i._runningAction=null,i._stopClick=!1,!(e instanceof BMapGL.Map))throw Error("Scene实例化必须输入map参数");return i.options={},m.deepCopy(qn,2,i.options,0,[Re]),m.copyOptions(i.options,s,[Re]),i.map=e,i.mask=new zn(e,i.options.drawCursor),i.operate=i.options.operate||new Re(e),i.options.operate&&(i.options.operate.ignore=!0),i.addMapListener(e),document.onkeydown=function(o){o.keyCode===i.options.keyCode&&(i._stopClick=!0)},document.onkeyup=function(o){o.keyCode===i.options.keyCode&&(i._stopClick=!1)},i}return x(n,[{key:"currentStatus",get:function(){return this._currentStatus},set:function(e){this._currentStatus=e,this.updateMapListenerControl(e)}},{key:"runningAction",get:function(){return this._runningAction},set:function(e){this._runningAction=e}},{key:"addMapListener",value:function(e){var i=this;this.mapSelect=new it(e),this.mapSelect.addEventListener(k.CLICK,function(s){i._currentStatus!==I.STATUS_MOVE&&i.dispatchEvent(s)}),this.mapSelect.addEventListener(k.RIGHTCLICK,function(s){i._currentStatus!==I.STATUS_MOVE&&i.dispatchEvent(s)}),this.mapSelect.addEventListener(k.MOVE,function(s){i._currentStatus!==I.STATUS_DRAWING&&i._currentStatus!==I.STATUS_EDITER&&i._currentStatus!==I.STATUS_MOVE&&i.dispatchEvent(s)})}},{key:"updateMapListenerControl",value:function(e){if(this.mapSelect)switch(e){case I.STATUS_FREE:this.mapSelect.open();break;case I.STATUS_EDITER:this.mapSelect.openClick(),this.mapSelect.openMouse();break;case I.STATUS_DRAWING:case I.STATUS_MOVE:this.mapSelect.closeClick(),this.mapSelect.openMouse();break;default:this.mapSelect.open()}}},{key:"open",value:function(){return this.isOpen=!0,this.mask||(this.mask=new zn(this.map,this.options.drawCursor)),this.map.addOverlay(this.mask),this.setCurrentDrawType(this.drawType),!0}},{key:"close",value:function(){var e=0>=arguments.length||arguments[0]===void 0||arguments[0];this.isOpen=!1,this.closeRunningAction(),e&&(this.currentStatus=I.STATUS_FREE),this.mask&&this.map.removeOverlay(this.mask)}},{key:"closeRunningAction",value:function(){this.runningAction&&this.runningAction.close instanceof Function&&this.runningAction.close()}},{key:"addOverlay",value:function(e){this.instances.find(function(i){return i===e})||this.instances.push(e)}},{key:"removeOverlay",value:function(e){var i=this.instances.findIndex(function(s){return s===e});i!==-1&&(this.map.removeOverlay(this.instances[i]),this.instances.splice(i)),this.operate&&this.map.removeOverlay(this.operate)}},{key:"clearData",value:function(){var e=this;this.instances.forEach(function(i){e.map.removeOverlay(i)}),this.instances.length=0}},{key:"addSelectDrawData",value:function(e){this.selectInstance.find(function(i){return i===e})||this.selectInstance.push(e)}},{key:"hasOverlay",value:function(e){var i=this.instances.findIndex(function(s){return s===e});return i>-1||(i=this.selectInstance.findIndex(function(s){return s===e}))>-1}},{key:"clearSelectDrawData",value:function(){var e=this;this.selectInstance.forEach(function(i){e.map.removeOverlay(i)}),this.selectInstance.length=0}},{key:"setCurrentDrawType",value:function(e){this.drawType=e}},{key:"attachSnapSource",value:function(e){this._attachSnapSource=e}},{key:"setDrawCursor",value:function(e){this.mask&&this.mask.setCursor(e)}},{key:"getStopStatus",value:function(){return this._stopClick}}]),n}(j),pe=function(r,t,n,e){var i,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o=(i=e.getZoom(),Math.pow(2,18-i));n*=o;var a,l=jt(t);try{var u=function(){var h=a.value;if(s.find(function(C){return h===C}))return"continue";if(h instanceof BMapGL.Marker){var p=h.getPosition(),f=1e3*N.getDistance(r,p,"kilometers");return n>f?{v:p}:"continue"}if(h.toGeoJSON){for(var v=h.getPath(),g=[],d=h.toGeoJSON(),y=0;v.length-1>y;y++)g.push(N.getLineCenter(v[y],v[y+1]).bdCenter);var w,b=jt(v.concat(g));try{for(b.s();!(w=b.n()).done;){var E=w.value,O=1e3*N.getDistance(r,E,"kilometers");if(n>O)return{v:E}}}catch(C){b.e(C)}finally{b.f()}var Y=N.getNearestPointOnLine(r,d);if(n>1e3*Y.toLineDistance)return{v:Y.bdNearestPoint}}};for(l.s();!(a=l.n()).done;){var c=u();if(c!=="continue"&&_(c)==="object")return c.v}}catch(h){l.e(h)}finally{l.f()}return null},ae=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(L(this,n),(i=t.call(this)).type=void 0,i.isOpen=void 0,i.isOnMap=!0,i.isSeries=!0,i.skipEditing=!1,i.isSelectDraw=!1,i.enableCalculate=!1,i.enableSnap=!0,i.snapDistance=10,i.enableDragging=!1,i.mouseLnglat=void 0,i.match=null,i.matchOverlay=null,i.matchOverlayRadius=5,i.limitPoint=-1,!e)return Tt(i);if(!(e instanceof He))throw Error("DrawBase实例化必须输入scene参数");i.scene=e;var o={};return m.copyOptionsToNew(i.scene.options,s,o),m.copyNotExitOptions(o,i.scene.options),i.defineProperty(o),i.options=o,i.setSnapPointType(i.options),i.setBaseOptions(i.options.baseOpts),i}return x(n,[{key:"bindEvent",value:function(){}},{key:"setBaseOptions",value:function(){this.baseOptions=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}}},{key:"setCurrentStatus",value:function(e){this.scene.currentStatus=e}},{key:"skipEdit",value:function(e){e||this.skipEditing?this.scene.operate.confirmOperate():this.scene.mask.hide()}},{key:"emitEventIsonmap",value:function(e){var i=X.DRAW_ON_MAP;this.isSelectDraw&&(i=X.SELECT_ON_MAP);var s=new A(k.COMPLETE,{overlay:e,from:i});this.dispatchEvent(s),this.scene.dispatchEvent(s)}},{key:"emitEventIsnomap",value:function(e){this.scene.currentStatus=I.STATUS_FREE;var i=X.DRAW_NO_MAP;this.isSelectDraw&&(i=X.SELECT_NO_MAP);var s=new A(k.COMPLETE,{overlay:e,from:i});this.dispatchEvent(s),this.scene.dispatchEvent(s)}},{key:"registEvent",value:function(e){var i=this;e.addEventListener(k.INIT,function(s){i.skipEdit()}),e.addEventListener(k.COMPLETE,function(s){i.isSelectDraw?i.scene.addSelectDrawData(s.target.overlay):i.scene.addOverlay(s.target.overlay),s.continue!==!1&&i.isSeries&&(i.isOpen=!0,i.scene.mask.show(),i.bindEvent()),i.dispatchEvent(s),i.editOpe=null}),e.addEventListener(k.CANCEL,function(s){i.isSeries&&(i.isOpen=!0,i.scene.mask.show(),i.bindEvent()),i.dispatchEvent(s),i.editOpe=null})}},{key:"setRunningAction",value:function(e,i){if(e){if(this.isSeries&&this.scene.runningAction===this)return void i();this.scene.closeRunningAction(),this.scene.mask.show(),this.scene.runningAction=this,i(),this.callback&&this.callback()}else this.scene.runningAction=null,this.isOpen=!1,this.scene.mask.hide()}},{key:"closeEdit",value:function(){this.editOpe&&this.editOpe.close()}},{key:"closeAll",value:function(){this.close(),this.closeEdit(),this.scene.mask.disableEdgeMove()}},{key:"open",value:function(e){this.scene&&(this.callback=e,this.scene.drawType=this.type,this.scene.open(),this.isOpen=!0,this.bindEvent())}},{key:"close",value:function(e){e&&e()}},{key:"addLabel",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=new BMapGL.Label(e,{position:i.position,offset:i.offset||new BMapGL.Size(0,0)});return s.setStyle(i.labelOptions),s}},{key:"setRadius",value:function(){var e=this.scene.map.getZoomUnits();this.matchOverlay.setRadius(this.matchOverlayRadius*e)}},{key:"addMatchOverlay",value:function(e){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(e),this.scene.map.addEventListener("zoomend",this._setRadius=this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(e))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this._setRadius&&(this.scene.map.removeEventListener("zoomend",this._setRadius),this._setRadius=null)}},{key:"getSnap",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=pe(e,i,o,a)),!l&&this.scene._attachSnapSource&&(l=pe(e,this.scene._attachSnapSource,o,a)),l||(l=pe(e,s,o,a)),l&&this.addMatchOverlay(l),l}}]),n}(j),It=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).type=B.DRAWING_MARKER,i.scene.setCurrentDrawType(i.type),i.mouseMoveModel=s.mouseMove||!1,i.isOpen&&i.open(),i}return x(n,[{key:"clickAction",value:function(e){var i=this;this.scene.getStopStatus()||this.marker&&!this.isOnMap||(this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("click",this.click),this.marker=new BMapGL.Marker(e.point,this.baseOptions),this.scene.map.addOverlay(this.marker),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap?(this.isSeries?(this.scene.mask.show(),this.bindEvent()):this.setCurrentStatus(I.STATUS_FREE),this.scene.addOverlay(this.marker),this.emitEventIsonmap(this.marker),this.enableDragging&&(this.marker.enableDragging(),this.marker.addEventListener("dragstart",this.centerDragstart.bind(this)),this.marker.addEventListener("dragging",this.centerDragging.bind(this)),this.marker.addEventListener("dragend",this.centerDragend.bind(this)))):(setTimeout(function(){i.scene.map.removeOverlay(i.marker),i.marker=null},200),this.emitEventIsnomap(this.marker)))}},{key:"moveAction",value:function(e){var i=new A(k.MOVE,e);this.dispatchEvent(i)}},{key:"centerDragstart",value:function(e){if(this.enableSnap){var i,s=e.target,o=BMapGL.Projection.convertMC2LL(s.point);(i=this.getSnap(o,this.scene.instances))&&(e.point=BMapGL.Projection.convertLL2MC(i),s.setPoint(e.point))}}},{key:"centerDragging",value:function(e){if(this.enableSnap){var i,s=e.target,o=BMapGL.Projection.convertMC2LL(s.point);(i=this.getSnap(o,this.scene.instances))&&(e.point=BMapGL.Projection.convertLL2MC(i),s.setPoint(e.point))}}},{key:"centerDragend",value:function(e){this.emitEventIsonmap(this.marker)}},{key:"bindEvent",value:function(){var e=this;this.isOpen&&$(J(n.prototype),"setRunningAction",this).call(this,!0,function(){e.setCurrentStatus(I.STATUS_DRAWING),e.mouseMoveModel&&e.scene.mask.addEventListener("mousemove",e.mousemove=e.moveAction.bind(e)),e.scene.mask.addEventListener("click",e.click=e.clickAction.bind(e))})}},{key:"close",value:function(e){$(J(n.prototype),"setRunningAction",this).call(this,!1),this.scene.mask.removeEventListener("click",this.click),this.mouseMoveModel&&this.scene.mask.addEventListener("mousemove",this.mousemove),e&&e()}}]),n}(ae),Ze=function(r){S(n,r);var t=P(n);function n(e,i){var s,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(L(this,n),(s=t.call(this)).overlay=null,s.centerIcon=null,s.moveIcon=null,s.circleMoveIcon=null,!(e instanceof He))throw Error("EditBase实例化必须输入scene参数");s.scene=e;var a={};return m.copyOptionsToNew(s.scene.options,o,a),m.copyNotExitOptions(a,s.scene.options),s.target=i||Le(s),s.setOptions(a),s}return x(n,[{key:"setOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.defineProperty(e),this.baseOptions=this.target.__proto__ instanceof ae?this.target.baseOptions:e.baseOpts}},{key:"saveSouce",value:function(e){this.source=this.type===B.DRAWING_CIRCLE?{center:e.getCenterIn().latLng,radius:e.getRadius()}:e.toGeoJSON()}},{key:"restoreSouce",value:function(e){this.source&&(this.type===B.DRAWING_CIRCLE?(e.setCenter(this.source.center),e.setRadius(this.source.radius)):e.updateByGeoJSON(this.source),this.restoreOpe(e))}},{key:"restoreOpe",value:function(){}},{key:"open",value:function(e,i,s){var o=this;this.scene&&(this.originStyle={icon:e._config.icon,fillColor:e._config.fillColor,fillOpacity:e._config.fillOpacity,strokeColor:e._config.strokeColor,strokeWeight:e._config.strokeWeight,strokeOpacity:e._config.strokeOpacity},this.overlay=e,this.overlay.setOptions(this.baseOptions),this.setRunningAction(!0,function(){o.setSceneStatus(I.STATUS_EDITER),o.edit(e,i),s&&s()}))}},{key:"emitOkEvent",value:function(e){var i=1>=arguments.length||arguments[1]===void 0||arguments[1],s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=X.DRAW_ON_MAP;this.target.__proto__ instanceof ae?this.target.isSelectDraw&&(o=X.SELECT_ON_MAP):o=X.EDIT_ON_MAP;var a=new A(k.COMPLETE,{overlay:e,from:o});a.continue=i,this.dispatchEvent(a),(s||this.type!==B.DRAWING_MARKER)&&this.scene.dispatchEvent(a)}},{key:"close",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;this.overlay&&(this.overlay.setOptions(this.originStyle),this.setRunningAction(!1),this.setSceneStatus(I.STATUS_FREE),this.operateWindow&&(this.removeAttachOverlays(),this.scene.map.removeOverlay(this.operateWindow)),e||this.emitOkEvent(this.overlay,e),this.type!==B.DRAWING_POLYLINE&&this.type!==B.DRAWING_POLYGON||this.overlay.removeEventListener("lineupdate",this.lineUpdate),this.closeOpe(this.overlay),i&&i())}},{key:"setRunningAction",value:function(e,i){e?(this.scene.closeRunningAction(),this.scene.runningAction=this,i()):this.scene.runningAction=null}},{key:"closeOpe",value:function(e){}},{key:"addOperateWindow",value:function(e){var i=this,s=X.DRAW_ON_MAP;this.target.__proto__ instanceof ae?this.target.isSelectDraw&&(s=X.SELECT_ON_MAP):(this.saveSouce(e.overlay),s=X.EDIT_ON_MAP);var o=this.operateWindow=this.scene.operate||new Re(this.scene.map);return o.setData(e),o.addEventListener("ok",function(a){i.removeAttachOverlays(),i.close(!0),i.emitOkEvent(a.target),o._listeners={}}),o.addEventListener("cancel",function(a){i.removeAttachOverlays(),i.close(!0),i.target.__proto__ instanceof ae?i.scene.map.removeOverlay(e.overlay):i.restoreSouce(e.overlay);var l=new A(k.CANCEL,{overlay:a.target,from:s+="-cancel"});i.dispatchEvent(l),i.scene.dispatchEvent(l),o._listeners={}}),this.scene.map.addOverlay(o),o}},{key:"removeAttachOverlays",value:function(){for(var e=this.scene.map,i=this.overlays,s=0;i.length>s;s++)if(Array.isArray(i[s]))for(var o in i[s])e.removeOverlay(i[s][o]);else e.removeOverlay(i[s])}},{key:"getSnap",value:function(e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.target.snapDistance,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,a=null;return a||(a=pe(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,s,o)),a||(a=pe(e,i,s,o)),a}}]),n}(j),Ct=function(r){S(n,r);var t=P(n);function n(e,i,s){var o;return L(this,n),(o=t.call(this,e,i,s)).type=B.DRAWING_POLYLINE,o.scene.setCurrentDrawType(o.type),o}return x(n,[{key:"edit",value:function(e,i){var s=this;this.overlay=e;var o=!1;this instanceof n&&this.target.__proto__ instanceof ae&&(o=!0);var a={limit:i||null,point:this.getNorthEast(e.getPath()),overlay:e};this.overlays=[];var l=this.addOperateWindow(a);this.lineUpdate=function(u){var c=s.getNorthEast(u.currentTarget.getPath());l.setPosition(c,!0),l.updateWindow();var h=new A(k.CHANGE,u.currentTarget);s.target.dispatchEvent(h)},this.onlinevertexdragging=function(u){var c=u.overlay,h=BMapGL.Projection.convertMC2LL(c.getPoint()),p=null;(p=o?s.getSnap(h,s.scene.instances,[s.overlay]):s.getSnap(h,s.scene.instances))&&(u.from.point=BMapGL.Projection.convertLL2MC(p),c.setPoint(u.from.point))},e.enableEditing(),e.addEventListener("lineupdate",this.lineUpdate),e.addEventListener("onlinevertexdragging",this.onlinevertexdragging),this.dispatchEvent(new A(k.INIT))}},{key:"restoreOpe",value:function(e){e.disableEditing()}},{key:"closeOpe",value:function(e){e.disableEditing()}},{key:"getNorthEast",value:function(e){for(var i=0,s=0,o=0;e.length>o;o++)e[o].lng>i&&(i=e[o].lng,s=o);return e[s]}}]),n}(Ze),jn=function(r){S(n,r);var t=P(n);function n(e,i,s){var o;return L(this,n),(o=t.call(this,e,i,s)).type=B.DRAWING_POLYGON,o.scene.setCurrentDrawType(o.type),o}return x(n)}(Ct),Ne=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).type=B.DRAWING_POLYLINE,i.points=[],i.drawPoint=[],i.overlay=null,i.isBinded=!1,i.tipLabel=null,i.measureRes=0,i.scene.setCurrentDrawType(i.type),i.isOpen&&i.open(),i}return x(n,[{key:"getNorthEast",value:function(e){for(var i=0,s=0,o=0;e.length>o;o++)e[o].lng>i&&(i=e[o].lng,s=o);return e[s]}},{key:"startAction",value:function(e){this.scene.getStopStatus()||(this.points.push(this.match?this.match:e.point),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.scene.drawType===B.DRAWING_POLYLINE?this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions):this.scene.drawType===B.DRAWING_POLYGON&&(this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions)),this.scene.map.addOverlay(this.overlay)):(this.overlay.setPath(this.drawPoint),this.limitPoint>0&&this.points.length>=this.limitPoint&&this.scene.drawType===B.DRAWING_POLYLINE&&this.dblclickAction(e)),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this))))}},{key:"moveAction",value:function(e){if(this.scene.getStopStatus())this.scene.map.removeOverlay(this.tipLabel);else{var i=e.point;if(this.enableSnap){var s=[];if(this.overlay.points.length>2){var o=this.overlay.getPath().slice(0,this.overlay.points.length-1);s.push(new this.overlay.constructor(o))}if(this.match=this.getSnap(i,this.scene.instances,s),this.match)return void this.overlay.setPositionAt(this.drawPoint.length-1,this.match)}this.match=null,this.overlay.setPositionAt(this.drawPoint.length-1,e.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}}},{key:"mousemoveAction",value:function(e){this.scene.getStopStatus()?this.scene.map.removeOverlay(this.tipLabel):(m.preventDefault(e),m.stopBubble(e),this.enableSnap&&(this.match=this.getSnap(e.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击确认起点",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel))}},{key:"dblclickAction",value:function(e){if(m.preventDefault(e),m.stopBubble(e),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var i=null;this.limit&&(i=this.scene.drawingType==="polygon"?this.limit.area:this.limit.distance),this.editOpe=this.type===B.DRAWING_POLYLINE?new Ct(this.scene,this):new jn(this.scene,this);var s=this.editOpe;this.registEvent(s),s.open(this.overlay,i)}else this.scene.map.removeOverlay(this.overlay),this.emitEventIsnomap(this.overlay)}},{key:"bindEvent",value:function(){var e=this;this.isOpen&&$(J(n.prototype),"setRunningAction",this).call(this,!0,function(){e.points.length=0,e.drawPoint.length=0,e.setCurrentStatus(I.STATUS_DRAWING),e.mousedown&&e.mousemove&&(e.isBinded=!1,e.scene.mask.removeEventListener("mousedown",e.mousedown),e.scene.mask.removeEventListener("mousemove",e.mousemove)),e.scene.mask.addEventListener("mousemove",e.mousemove=e.mousemoveAction.bind(e)),e.scene.mask.addEventListener("mousedown",e.mousedown=e.startAction.bind(e))})}},{key:"close",value:function(e){this.isBinded=!1,this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),$(J(n.prototype),"setRunningAction",this).call(this,!1),e&&e()}}]),n}(ae),qe=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).type=B.DRAWING_POLYGON,i.scene.setCurrentDrawType(i.type),i}return x(n)}(Ne),Un=function(r){S(n,r);var t=P(n);function n(e,i,s,o,a){var l;return L(this,n),(l=t.call(this)).scene=a,l.type=e,l.point=i,l.number=s,l.overlay=o,l}return x(n,[{key:"initialize",value:function(e){this.map=e;var i,s=this.div=document.createElement("div");return s.className="screenshot",this.type==="circle"?i=`
                <div class="circlShot">
                <span id="screenshotNum">`.concat(this.number,`</span>
                <input id="circleInput" type="text" />
                <span class="unit">米</span>
                </div>
            `):this.type==="rectangle"&&(i=`
                <div class="rectWH">
                <div class="wh">
                    <span id="rectWidth">`.concat(this.number.width,`</span>
                    <input id="rectWidthInput" type="text" />
                </div>
                <span class="multiple">x</span>
                <div class="wh">
                    <span id="rectHeight">`).concat(this.number.height,`</span>
                    <input id="rectHeightInput" type="text" />
                </div>
                <span class="unit">米</span>
                </div>
            `)),s.innerHTML=i,s.addEventListener("mousemove",function(o){m.preventDefault(o),m.stopBubble(o)}),s.addEventListener("dblclick",function(o){m.preventDefault(o),m.stopBubble(o)}),this.map.getPanes().markerPane.appendChild(s),this.bind(),s}},{key:"bind",value:function(){this.setNumber(this.number),this.type==="circle"?this.bindCircleEvent():this.bindRectEvent()}},{key:"bindCircleEvent",value:function(){var e=this,i=document.getElementById("screenshotNum"),s=document.getElementById("circleInput");i.addEventListener("click",function(o){var a=i.innerText;i.style.display="none",s.value=a,s.style.display="inline-block",s.focus()}),s.addEventListener("click",function(o){s.focus()}),s.addEventListener("keydown",function(o){if(o.keyCode===13){var a=s.value;s.style.display="none",i.innerText=a,e.dispatchRadiusChange({radius:a,overlay:e.overlay})}}),s.addEventListener("blur",function(o){var a=s.value;s.style.display="none",i.style.display="inline-block",i.innerText=a,e.dispatchRadiusChange({radius:a,overlay:e.overlay})})}},{key:"bindRectEvent",value:function(){var e=this,i=document.getElementById("rectWidth"),s=document.getElementById("rectWidthInput"),o=document.getElementById("rectHeight"),a=document.getElementById("rectHeightInput");s.value=i.innerText,a.value=o.innerText,i.addEventListener("click",function(l){var u=i.innerText;i.style.display="none",s.value=u,s.style.display="inline-block",s.focus()}),o.addEventListener("click",function(l){var u=o.innerText;o.style.display="none",a.value=u,a.style.display="inline-block",a.focus()}),s.addEventListener("click",function(l){s.focus()}),a.addEventListener("click",function(l){a.focus()}),s.addEventListener("keydown",function(l){if(l.keyCode===13){var u=s.value,c=a.value;a.style.display="none",a.style.display="none",i.style.display="inline-block",a.style.display="inline-block",i.innerText=u,o.innerText=c,e.dispatchRectWHChange({width:u,height:c,overlay:e.overlay})}}),a.addEventListener("keydown",function(l){if(l.keyCode===13){var u=s.value,c=a.value;s.style.display="none",a.style.display="none",i.style.display="inline-block",o.style.display="inline-block",i.innerText=u,o.innerText=c,e.dispatchRectWHChange({width:u,height:c,overlay:e.overlay})}})}},{key:"setInfo",value:function(e,i){this.setNumber(i),this.setPosition(e)}},{key:"setNumber",value:function(e){this.type==="circle"?document.getElementById("screenshotNum").textContent=e:(document.getElementById("rectWidth").textContent=e.width,document.getElementById("rectHeight").textContent=e.height)}},{key:"setPosition",value:function(e){this.point=e;var i=this.type,s=this.map.pointToOverlayPixel(this.point);i==="circle"?(this.div.style.left=s.x-30+"px",this.div.style.top=s.y-40+"px"):i==="rectangle"&&(this.div.style.left=s.x+"px",this.div.style.top=s.y-45+"px")}},{key:"draw",value:function(){var e=this.map.pointToOverlayPixel(this.point);this.type==="circle"?(this.div.style.left=e.x-30+"px",this.div.style.top=e.y-40+"px"):this.type==="rectangle"&&(this.div.style.left=e.x+"px",this.div.style.top=e.y-45+"px")}},{key:"dispatchRadiusChange",value:function(e){var i=new A("radiuschange",e);this.dispatchEvent(i)}},{key:"dispatchRectWHChange",value:function(e){var i=new A("rectwhchange",e);this.dispatchEvent(i)}}]),n}(nt(BMapGL.Overlay,j)),Yn=function(r){S(n,r);var t=P(n);function n(e,i,s){var o;return L(this,n),(o=t.call(this,e,i,s)).type=B.DRAWING_RECTANGLE,o.scene.setCurrentDrawType(o.type),o}return x(n,[{key:"setIcon",value:function(e){this.moveIcon=e}},{key:"edit",value:function(e,i){var s=this;this.overlay=e;for(var o=this.getBox(e.getPath()),a=o.startPoint,l=o.endPoint,u=[],c=this.getRectAllPoints(a,l),h=[],p=this.scene.map.getDistance(a,c[2]).toFixed(0),f=this.scene.map.getDistance(a,c[6]).toFixed(0),v=new Un("rectangle",c[0],{width:p,height:f},e,this.scene),g=0;c.length>g;g++){var d=new BMapGL.Marker(c[g]);d.setIcon(this.target&&this.target.moveIcon?this.target.moveIcon:this.moveIcon),d.enableDragging(),u.push(d),this.scene.map.addOverlay(d),h[g]=m.mc2ll(d.point,this.scene.map),d.addEventListener("mousedown",function(w){l=m.mc2ll(w.target.point,s.scene.map)}),d.addEventListener("dragging",function(w){for(var b=w.latLng,E=0;h.length>E;E++)l.lng==h[E].lng&&(c[E].lng=b.lng),l.lat==h[E].lat&&(c[E].lat=b.lat);c=s.getRectAllPoints(c[0],c[4]);for(var O=0;u.length>O;O++)u[O].setPosition(c[O]);p=s.scene.map.getDistance(c[0],c[2]).toFixed(0),f=s.scene.map.getDistance(c[0],c[6]).toFixed(0),v.setInfo(c[0],{width:p,height:f}),y.setPosition(c[3],!0),e.setPath(c)}),d.addEventListener("dragend",function(w){for(var b=0;u.length>b;b++)h[b]=m.mc2ll(u[b].point,s.scene.map);y.updateWindow();var E=new A(k.CHANGE,e);s.target.dispatchEvent(E)})}v.addEventListener("rectwhchange",function(w){var b=w.target.width,E=w.target.height,O=m.getPointByDistance(c[0],b,"east"),Y=m.getPointByDistance(c[0],E,"south");c[4].lng=O.lng,c[4].lat=Y.lat,c=s.getRectAllPoints(c[0],c[4]);for(var C=0;u.length>C;C++)u[C].setPosition(c[C]);v.setInfo(c[0],{width:b,height:E}),y.setPosition(c[3],!0),e.setPath(c);for(var z=0;u.length>z;z++)h[z]=m.mc2ll(u[z].point,s.scene.map);y.updateWindow();var q=new A(k.CHANGE,e);s.target.dispatchEvent(q)}),this.overlays=[u,v];var y=this.addOperateWindow({limit:i,point:c[3],overlay:e});this.scene.map.addOverlay(v),this.dispatchEvent(new A(k.INIT)),this.onlinevertexdragging=function(w){console.log(w);var b,E=w.overlay,O=BMapGL.Projection.convertMC2LL(E.getPoint());(b=s.getSnap(O,s.scene.instances))&&(w.from.point=BMapGL.Projection.convertLL2MC(b),E.setPoint(w.from.point))},e.addEventListener("onlinevertexdragging",this.onlinevertexdragging)}},{key:"getBox",value:function(e){var i=1/0,s=-1/0,o=-1/0,a=1/0;return e.forEach(function(l){i>l.lng&&(i=l.lng),l.lat>s&&(s=l.lat),l.lng>o&&(o=l.lng),a>l.lat&&(a=l.lat)}),{startPoint:new BMapGL.Point(i,s),endPoint:new BMapGL.Point(o,a)}}},{key:"getRectAllPoints",value:function(e,i){var s=new BMapGL.Point(e.lng,e.lat),o=new BMapGL.Point(i.lng,e.lat),a=new BMapGL.Point(i.lng,i.lat),l=new BMapGL.Point(e.lng,i.lat);return[s,new BMapGL.Point((e.lng+i.lng)/2,e.lat),o,new BMapGL.Point(i.lng,(e.lat+i.lat)/2),a,new BMapGL.Point((e.lng+i.lng)/2,i.lat),l,new BMapGL.Point(e.lng,(e.lat+i.lat)/2)]}},{key:"getRectanglePoint",value:function(e,i){return[new BMapGL.Point(e.lng,e.lat),new BMapGL.Point(i.lng,e.lat),new BMapGL.Point(i.lng,i.lat),new BMapGL.Point(e.lng,i.lat)]}}]),n}(Ze),Rt=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).type=B.DRAWING_RECTANGLE,i.polygon=null,i.startPoint=null,i.scene.setCurrentDrawType(i.type),i.moveIcon=new BMapGL.Icon(Ut,new BMapGL.Size(10,10)),i.moveIcon.setImageSize(new BMapGL.Size(10,10)),i.isOpen&&i.open(),i}return x(n,[{key:"getRectAllPoints",value:function(e,i){var s=new BMapGL.Point(e.lng,e.lat),o=new BMapGL.Point(i.lng,e.lat),a=new BMapGL.Point(i.lng,i.lat),l=new BMapGL.Point(e.lng,i.lat);return[s,new BMapGL.Point((e.lng+i.lng)/2,e.lat),o,new BMapGL.Point(i.lng,(e.lat+i.lat)/2),a,new BMapGL.Point((e.lng+i.lng)/2,i.lat),l,new BMapGL.Point(e.lng,(e.lat+i.lat)/2)]}},{key:"getRectanglePoint",value:function(e,i){return[new BMapGL.Point(e.lng,e.lat),new BMapGL.Point(i.lng,e.lat),new BMapGL.Point(i.lng,i.lat),new BMapGL.Point(e.lng,i.lat)]}},{key:"startAction",value:function(e){if(!this.scene.getStopStatus()){m.stopBubble(e),m.preventDefault(e);var i=this.startPoint=e.point;this.enableSnap&&this.match&&(i=this.startPoint=this.match);var s=this.endPoint=i;this.polygon=new BMapGL.Polygon(this.getRectanglePoint(i,s),this.baseOptions),this.scene.map.addOverlay(this.polygon),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}}},{key:"moveAction",value:function(e){if(this.scene.map.removeOverlay(this.tipLabel),!this.scene.getStopStatus())if(this.enableSnap&&(this.match=this.getSnap(e.point,this.scene.instances),this.match))this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match));else{this.match=null,this.polygon.setPath(this.getRectanglePoint(this.startPoint,e.point));var i=this.getRectAllPoints(this.startPoint,e.point),s=this.scene.map.getDistance(this.startPoint,i[2]).toFixed(0),o=this.scene.map.getDistance(this.startPoint,i[6]).toFixed(0);this.tipLabel=new BMapGL.Label("尺寸："+s+"米 x "+o+"米<br>松开结束绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}}},{key:"endAction",value:function(e){if(!this.scene.getStopStatus())if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.enableSnap?(this.match=this.getSnap(e.point,this.scene.instances),this.match&&this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match))):this.polygon.setPath(this.getRectanglePoint(this.startPoint,e.point)),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var i=null;this.options.limit&&(i=this.options.limit.area);var s=this.editOpe=new Yn(this.scene,this);this.registEvent(s),s.open(this.polygon,i)}else this.scene.map.removeOverlay(this.polygon),this.emitEventIsnomap(this.polygon)}},{key:"mousemoveAction",value:function(e){this.scene.getStopStatus()?this.scene.map.removeOverlay(this.tipLabel):(m.preventDefault(e),m.stopBubble(e),this.enableSnap&&(this.match=this.getSnap(e.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel))}},{key:"bindEvent",value:function(){var e=this;this.isOpen&&$(J(n.prototype),"setRunningAction",this).call(this,!0,function(){e.setCurrentStatus(I.STATUS_DRAWING),e.mousedown&&e.mousemove&&(e.scene.mask.removeEventListener("mousedown",e.mousedown),e.scene.mask.removeEventListener("mousemove",e.mousemove)),e.scene.mask.addEventListener("mousemove",e.mousemove=e.mousemoveAction.bind(e)),e.scene.mask.addEventListener("mousedown",e.mousedown=e.startAction.bind(e))})}},{key:"close",value:function(e){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),$(J(n.prototype),"setRunningAction",this).call(this,!1),e&&e()}}]),n}(ae),Jn=function(r){S(n,r);var t=P(n);function n(e,i,s){var o;return L(this,n),(o=t.call(this,e,i,s)).type=B.DRAWING_CIRCLE,o.scene.setCurrentDrawType(o.type),o}return x(n,[{key:"setCenterIcon",value:function(e){this.centerIcon=e}},{key:"setMoveIcon",value:function(e){this.moveIcon=e}},{key:"edit",value:function(e,i){var s=this;this.overlay=e,this.centerPoint=e.getCenterIn().latLng;var o=new BMapGL.Point(e.getBounds().getNorthEast().lng,this.centerPoint.lat),a=this.centerMarker=new BMapGL.Marker(this.centerPoint);a.setIcon(this.centerIcon),a.enableDragging(),a.addEventListener("dragstart",this.centerDragstart.bind(this)),a.addEventListener("dragging",this.centerDragging.bind(this)),a.addEventListener("dragend",this.centerDragend.bind(this)),this.scene.map.addOverlay(a);var l=this.moveMarker=new BMapGL.Marker(o);l.setIcon(this.circleMoveIcon),l.enableDragging();var u=this.polyline=new BMapGL.Polyline([this.centerPoint,o],this.baseOptions||{}),c=new BMapGL.Point((e.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,this.centerPoint.lat),h=this.radiusWindow=new Un("circle",c,Math.ceil(e.getRadius()),e,this.scene);this.overlays=[a,l,u,h];var p=this.operateWindow=this.addOperateWindow({limit:i,point:o,overlay:e});this.scene.map.addOverlay(l),this.scene.map.addOverlay(u),this.scene.map.addOverlay(h);var f=1;h.addEventListener("radiuschange",function(v){if(v.target.radius&&!isNaN(v.target.radius)){e.setRadius(f=v.target.radius);var g=m.getPointByDistance(s.centerPoint,f,"east"),d=new BMapGL.Point(g.lng,s.centerPoint.lat),y=g.lng>s.centerPoint.lng?(e.getBounds().getNorthEast().lng+s.centerPoint.lng)/2:(e.getBounds().getSouthWest().lng+s.centerPoint.lng)/2,w=new BMapGL.Point(y,s.centerPoint.lat);l.setPosition(d),h.setInfo(w,f),p.setPosition(d,!0),p.updateWindow(),u.setPath([s.centerPoint,d]);var b=new A(k.CHANGE,e);s.target.dispatchEvent(b)}}),l.addEventListener("dragging",function(v){var g=new BMapGL.Point(v.latLng.lng,s.centerPoint.lat),d=v.latLng.lng>s.centerPoint.lng?(e.getBounds().getNorthEast().lng+s.centerPoint.lng)/2:(e.getBounds().getSouthWest().lng+s.centerPoint.lng)/2,y=v.latLng.lng>s.centerPoint.lng,w=new BMapGL.Point(d,s.centerPoint.lat);v.target.setPosition(g),h.setInfo(w,s.scene.map.getDistance(s.centerPoint,v.latLng).toFixed(0)),p.setPosition(g,y),u.setPath([s.centerPoint,g]),f=s.scene.map.getDistance(s.centerPoint,v.latLng).toFixed(0),e.setRadius(s.scene.map.getDistance(s.centerPoint,v.latLng))}),l.addEventListener("dragend",function(v){p.updateWindow();var g=new A(k.CHANGE,e);s.target.dispatchEvent(g)}),this.dispatchEvent(new A(k.INIT))}},{key:"centerDragstart",value:function(e){this.moveMarker.hide(),this.polyline.hide(),this.radiusWindow.hide(),this.operateWindow.hide()}},{key:"centerDragging",value:function(e){this.centerPoint=e.latLng,this.overlay.setCenter(e.latLng)}},{key:"centerDragend",value:function(e){this.centerPoint=e.latLng;var i=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.moveMarker.setPosition(i),this.moveMarker.show();var s=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.polyline.setPath([this.centerPoint,s]),this.polyline.show();var o=(this.overlay.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,a=new BMapGL.Point(o,this.centerPoint.lat);this.radiusWindow.setPosition(a),this.operateWindow.setPosition(s,!0),this.radiusWindow.show(),this.operateWindow.show();var l=new A(k.CHANGE,this.circle);this.target.dispatchEvent(l)}}]),n}(Ze),Nt=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).type=B.DRAWING_CIRCLE,i.circle=null,i.overlays=[],i.centerPoint=null,i.radius=1,i.moveMarker=null,i.polyline=null,i.radiusWindow=null,i.operateWindow=null,i.scene.setCurrentDrawType(i.type),i.isOpen&&i.open(),i}return x(n,[{key:"startAction",value:function(e){this.scene.getStopStatus()||(this.centerPoint=e.point,this.circle=new BMapGL.Circle(this.centerPoint,this.radius,this.baseOptions),this.scene.map.addOverlay(this.circle),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this)))}},{key:"moveAction",value:function(e){this.scene.map.removeOverlay(this.tipLabel),this.scene.getStopStatus()||(this.radius=this.scene.map.getDistance(this.centerPoint,e.point).toFixed(0),this.circle.setRadius(this.radius),this.tipLabel=new BMapGL.Label("半径："+this.radius+"米<br>松开完成绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel))}},{key:"endAction",value:function(e){if(!this.scene.getStopStatus())if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var i=null;this.limit&&(i=this.limit.area);var s=this.editOpe=new Jn(this.scene,this);this.registEvent(s),s.open(this.circle,i)}else this.scene.map.removeOverlay(this.centerMarker),this.scene.map.removeOverlay(this.circle),this.emitEventIsnomap(this.circle)}},{key:"mousedownAction",value:function(e){this.scene.getStopStatus()||(m.preventDefault(e),m.stopBubble(e),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.centerPoint==null&&this.startAction(e))}},{key:"mousemoveAction",value:function(e){this.scene.map.removeOverlay(this.tipLabel),this.scene.getStopStatus()||(m.preventDefault(e),m.stopBubble(e),this.tipLabel=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel))}},{key:"bindEvent",value:function(){var e=this;this.isOpen&&$(J(n.prototype),"setRunningAction",this).call(this,!0,function(){e.centerPoint=null,e.radius=1,e.setCurrentStatus(I.STATUS_DRAWING),e.mousedown&&e.mousemove&&(e.scene.mask.removeEventListener("mousedown",e.mousedown),e.scene.mask.removeEventListener("mousemove",e.mousemove)),e.scene.mask.addEventListener("mousemove",e.mousemove=e.mousemoveAction.bind(e)),e.scene.mask.addEventListener("mousedown",e.mousedown=e.mousedownAction.bind(e))})}},{key:"close",value:function(e){$(J(n.prototype),"setRunningAction",this).call(this,!1),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),e&&e()}}]),n}(ae),Wi=function(r){S(n,r);var t=P(n);function n(e,i,s){var o;return L(this,n),(o=t.call(this,e,i,s)).type=B.DRAWING_MARKER,o.scene.setCurrentDrawType(o.type),o}return x(n,[{key:"setIcon",value:function(e){this.moveIcon=e}},{key:"edit",value:function(e){e.enableDragging(),e.addEventListener("dragstart",this.centerDragstart.bind(this)),e.addEventListener("dragging",this.centerDragging.bind(this)),e.addEventListener("dragend",this.centerDragend.bind(this))}},{key:"centerDragstart",value:function(e){}},{key:"centerDragging",value:function(e){var i,s=e.target,o=BMapGL.Projection.convertMC2LL(s.point);(i=this.getSnap(o,this.scene.instances))&&(e.point=BMapGL.Projection.convertLL2MC(i),s.setPoint(e.point))}},{key:"centerDragend",value:function(e){this.emitOkEvent(this.overlay,!0,!0);var i=new A(k.CHANGE,this.overlay);this.target.dispatchEvent(i)}},{key:"closeOpe",value:function(e){e.disableDragging(),e.removeEventListener("dragstart",this.centerDragstart),e.removeEventListener("dragging",this.centerDragging),e.removeEventListener("dragend",this.centerDragend)}}]),n}(Ze),zi=function(r){S(n,BMapGL.Control);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this)).scene=e,i.opts=s,i.drawingItems=s.drawingItems||ni,i.defaultAnchor=s.anchor||BMAP_ANCHOR_TOP_LEFT,i.defaultOffset=s.offset||new BMapGL.Size(20,20),i.initialize(i.scene.map),i}return x(n,[{key:"initialize",value:function(e){this._map=e;var i=this.container=document.createElement("div");i.className="BMap_Drawing";var s=this.panel=document.createElement("div");s.className="BMap_Draw_Panel",i.appendChild(s);var o=this.generalHtml(e);s.appendChild(o);var a=this.tip=document.createElement("div");return a.className="BMapDraw_tip",a.innerHTML='<p class="BMapDraw_tip_title"></p><p class="BMapDraw_tip_text"></p>',this.opts.enableTips&&s.appendChild(a),e.getContainer().appendChild(i),this.bindEvt(),i}},{key:"generalHtml",value:function(e){for(var i=this,s={hander:"拖动地图",marker:"标记点",polyline:"折线",polygon:"多边形",circle:"圆形",rectangle:"矩形"},o=function(c,h){var p=document.createElement("a");return p.className=c,p.href="javascript:void(0)",p.setAttribute("drawingType",h),p.setAttribute("onfocus","this.blur()"),p.addEventListener("mouseenter",function(f){var v=f.target.getAttribute("drawingType"),g=s[v];v==="hander"?(i.tip.children[0].innerText=g,i.tip.children[1].innerText="使用鼠标拖动地图"):(i.tip.className+=" "+v,i.tip.children[0].innerText=g,i.tip.children[1].innerText="使用"+g+"选出目标区域"),i.tip.style.display="block"}),p.addEventListener("mouseleave",function(f){for(var v=f.target.getAttribute("drawingType"),g=" "+i.tip.className.replace(/[\t\r\n]/g,"")+" ";g.indexOf(" "+v+" ")>=0;)g=g.replace(" "+v+" "," ");i.tip.className=g.replace(/^\s+|\s+$/g,""),i.tip.style.display="none"}),p},a=document.createDocumentFragment(),l=0,u=this.drawingItems.length;u>l;l++)a.appendChild(o("BMapDraw_Box BMapDraw_"+this.drawingItems[l],this.drawingItems[l]));return a}},{key:"setStyleByDrawingItems",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"marker",i=this.panel.getElementsByTagName("a"),s=0,o=i.length;o>s;s++){var a=i[s];a.getAttribute("drawingType")===e?a.className="BMapDraw_Box BMapDraw_"+e+"_hover":a.className=a.className.replace(/_hover/,"")}}},{key:"bindEventByDrawingType",value:function(e){var i=this.scene;if(i.isOpen&&i.drawType===e)i.close(),i.map.enableDoubleClickZoom();else switch(e){case"marker":new It(i).open();break;case"polyline":new Ne(i).open();break;case"polygon":new qe(i).open();break;case"circle":new Nt(i).open();break;case"rectangle":new Rt(i).open()}}},{key:"bindEvt",value:function(e){var i=this;m.on(this.panel,"click",function(s){var o=m.getTarget(s).getAttribute("drawingType");i.setStyleByDrawingItems(o),i.bindEventByDrawingType(o)})}}]),n}(),ji=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this)).type=null,i.instance=null,i.graphicOpts=Xt,i.labelOptions=xe,i.isOnMap=!1,i.isSeries=!1,i.skipEditing=!1,i.mouseMove=!0,i.enableSnap=!1,i.limitPoint=-1,i.scene=e,i.defineProperty(s),i}return x(n,[{key:"close",value:function(e){this.instance&&(this.instance.close(),this.instance=null),e&&e()}},{key:"open",value:function(e){this.close(),this.scene.close(),this.defineProperty(e),this.type&&this.doAction()}},{key:"doAction",value:function(){var e=this;this.data=[];var i={isSelectDraw:!0,isOpen:!0,enableSnap:this.enableSnap,isOnMap:this.isOnMap,isSeries:this.isSeries,skipEditing:this.skipEditing,labelOptions:this.labelOptions,baseOpts:this.graphicOpts,mouseMove:this.mouseMove,limitPoint:this.limitPoint};switch(this.type){case B.DRAWING_POLYLINE:this.instance=new Ne(this.scene,i);break;case B.DRAWING_POLYGON:this.instance=new qe(this.scene,i);break;case B.DRAWING_RECTANGLE:this.instance=new Rt(this.scene,i);break;case B.DRAWING_CIRCLE:this.instance=new Nt(this.scene,i);break;case B.DRAWING_MARKER:this.instance=new It(this.scene,i);break;case B.DRAWING_POINT:this.instance=new it(this.scene.map);break;default:this.close()}this.instance&&(this.instance.addEventListener(k.CHANGE,function(s){e.dispatchEvent(s)}),this.instance.addEventListener(k.MOVE,function(s){e.dispatchEvent(s)}),this.instance.addEventListener(k.CLICK,function(s){e.dispatchEvent(s);var o=new A(k.COMPLETE,{from:X.SELECT_NO_MAP,mouseTarget:s.target,overlay:new BMapGL.Marker(new BMapGL.Point(s.target.latlng.lng,s.target.latlng.lat))});e.scene.dispatchEvent(o)}),this.instance.addEventListener(k.COMPLETE,function(s){e.dispatchEvent(s)}),this.instance.addEventListener(k.CANCEL,function(s){e.dispatchEvent(s)}))}},{key:"addData",value:function(e){this.scene&&this.scene.addSelectDrawData(e)}},{key:"clearData",value:function(){this.scene&&this.scene.clearSelectDrawData()}}]),n}(j),Ui=function(){function r(t,n){L(this,r),this.label=void 0,this.scene=t}return x(r,[{key:"getLength",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};t instanceof BMapGL.Polyline&&(t=t.toGeoJSON());var e=N.getLength(t);if(n.showlabel){var i=t.geometry.coordinates,s=new BMapGL.Point(i[i.length-1][0],i[i.length-1][1]),o="";switch(n.unit){case"kilometers":o="总长度："+e.toFixed(2)+"km";break;case"meters":o="总长度："+e.toFixed(2)+"m"}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(o,{position:s,offset:n.offset||new BMapGL.Size(0,0)}),this.label.setStyle(n.labelOptions),this.scene.map.addOverlay(this.label)}return e}},{key:"getPolygonArea",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};t instanceof BMapGL.Polygon&&(t=t.toGeoJSON());var e=N.getPolygonArea(t);if(n.showlabel){var i=N.getPolygonCenter(t),s="";switch(n.unit){case"kilometers":s=e.toFixed(2)+" km²";break;case"meters":s=e.toFixed(2)+" m²"}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(s,{position:i.bdCenter,offset:n.offset||new BMapGL.Size(-20,-10)}),this.label.setStyle(n.labelOptions),this.scene.map.addOverlay(this.label)}return e}}]),r}(),Yi=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).tipLabel=null,i.lengthLabel=[],i.totalLabel=null,i.turnOverlays=[],i.totalLength=0,i.measureRes=0,i.subDistance=[],i.scene.setCurrentDrawType(i.type),i.setOtherOptions(s),i.isOpen&&i.open(),i}return x(n,[{key:"setOtherOptions",value:function(e){this.options=e,this.skipEditing=!0,this.isOpen=!0,this.options=Object.assign(ei,e),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(e){var i=this.options,s=new BMapGL.Marker(e,{icon:i.turnIcon?i.turnIcon:Jt,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(e){var i=this.match?this.match:e.point;this.points.push(i),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.turnOverlays=[],this.lengthLabel=[],this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay)):(this.overlay.setPath(this.drawPoint),this.scene.map.removeOverlay(this.measureLabel),this.scene.map.addOverlay(this.downLabel),this.subDistance.push(this.downLabel.content),this.lengthLabel.push(this.downLabel)),this.setTurnPoint(i),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"moveAction",value:function(e){var i=e.point;if(this.enableSnap){var s=[];if(this.overlay.points.length>2){var o=this.overlay.getPath().slice(0,this.overlay.points.length-1);s.push(new this.overlay.constructor(o))}if(this.match=this.getSnap(i,this.scene.instances,s),this.match)return void this.overlay.setPositionAt(this.drawPoint.length-1,this.match)}this.match=null;var a=this.drawPoint[this.drawPoint.length-2],l=e.point;this.measureRes=N.getDistance(a,l),this.distance=this.measureRes.toFixed(2)+"km";var u=N.getLineCenter(a,l);this.scene.map.removeOverlay(this.measureLabel),this.measureLabel=this.addLabel(this.distance,{position:u.bdCenter}),this.downLabel=this.addLabel(this.distance,{position:u.bdCenter}),this.scene.map.addOverlay(this.measureLabel),this.overlay.setPositionAt(this.drawPoint.length-1,e.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label(this.options.followLabel,{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"dblclickAction",value:function(e){var i=this;m.preventDefault(e),m.stopBubble(e),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick);var s=this.overlay.toGeoJSON(),o=s.geometry.coordinates,a=new BMapGL.Point(o[o.length-1][0],o[o.length-1][1]),l=[0,0],u=[0,0],c=this.scene.map.pointToPixel(this.points[this.points.length-2]),h=this.scene.map.pointToPixel(this.points[this.points.length-3]);l=0>c.x-h.x?[-14,0]:[14,0],u=0>c.y-h.y?[-5,-38]:[-5,11];var p=N.getLength(s,this.options.unit);this.totalLength=p;var f="";switch(this.options.unit){case"kilometers":f="总长："+p.toFixed(2)+"km";break;case"meters":f="总长："+p.toFixed(2)+"m"}this.totalLabel=new BMapGL.Label(f,{position:a,offset:new BMapGL.Size(u[0],u[1])}),this.totalLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.totalLabel),this.lengthLabel.push(this.totalLabel),this.closeIcon=this.options.closeIcon?this.options.closeIcon:Yt,this.closeBtn=new BMapGL.Marker(a,{icon:this.closeIcon,baseZIndex:36e5,offset:new BMapGL.Size(l[0],l[1]),enableMassClear:!0}),this.closeBtn.setTitle("清除本次测距"),this.scene.map.addOverlay(this.closeBtn);var v={overlay:this.overlay,closeBtn:this.closeBtn,totalLabel:this.totalLabel,lengthLabel:this.lengthLabel,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0)};this.closeBtn.addEventListener("click",function(g){i.scene.map.removeOverlay(v.closeBtn),i.scene.map.removeOverlay(v.overlay);for(var d=0,y=v.turnOverlays.length;y>d;d++)i.scene.map.removeOverlay(v.turnOverlays[d]),v.turnOverlays[d]=null;for(var w=0,b=v.lengthLabel.length;b>w;w++)i.scene.map.removeOverlay(v.lengthLabel[w]),v.lengthLabel[w]=null}),this.dispatchMeasureEvent(),this.overlay.setPath(this.points),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var e=new A(et.LENGTH_END,{points:this.points?this.points.slice(0):[],distance:this.totalLength,subDistance:this.subDistance,unit:this.options.unit,overlay:this.overlay});this.dispatchEvent(e),this.scene.dispatchEvent(e)}}]),n}(Ne),Ji=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,n),(i=t.call(this,e,s)).measureArea=0,i.turnOverlays=[],i.scene.setCurrentDrawType(i.type),i.setOtherOptions(s),i.isOpen&&i.open(),i}return x(n,[{key:"setOtherOptions",value:function(e){this.options=e,this.skipEditing=!0,this.isOpen=!0,this.options=Object.assign($n,e),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(e){var i=this.options,s=new BMapGL.Marker(e,{icon:i.turnIcon?i.turnIcon:Jt,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(e){var i=this.match?this.match:e.point;if(this.points.push(i),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1)this.turnOverlays=[],this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay);else if(this.overlay.setPath(this.drawPoint),this.points.length>2){this.measureArea=N.getPolygonArea(this.overlay),this.area=this.measureArea.toFixed(2)+"km²";var s=N.getPolygonCenter(this.overlay.toGeoJSON());this.scene.map.removeOverlay(this.areaLabel),this.areaLabel=this.addLabel(this.area,{position:s.bdCenter,offset:new BMapGL.Size(5,-2)}),this.scene.map.addOverlay(this.areaLabel)}this.setTurnPoint(i),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"dblclickAction",value:function(e){var i=this;m.preventDefault(e),m.stopBubble(e),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points);var s=this.overlay.toGeoJSON().geometry.coordinates[0],o=new BMapGL.Point(s[s.length-1][0],s[s.length-1][1]);this.closeIcon=this.options.closeIcon?this.options.closeIcon:Yt,this.closeBtn=new BMapGL.Marker(o,{icon:this.closeIcon,baseZIndex:36e5,enableMassClear:!0,offset:new BMapGL.Size(10,10)});var a=N.getPolygonCenter(this.overlay.toGeoJSON());this.totalAreaLabel=this.addLabel(this.area,{position:a.bdCenter,offset:new BMapGL.Size(5,-2)});var l={overlay:this.overlay,closeBtn:this.closeBtn,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0),totalAreaLabel:this.totalAreaLabel};this.scene.map.addOverlay(l.closeBtn),this.scene.map.removeOverlay(this.areaLabel),this.scene.map.addOverlay(l.totalAreaLabel),l.closeBtn.addEventListener("click",function(u){i.scene.map.removeOverlay(l.closeBtn),i.scene.map.removeOverlay(l.overlay),i.scene.map.removeOverlay(l.totalAreaLabel);for(var c=0,h=l.turnOverlays.length;h>c;c++)i.scene.map.removeOverlay(l.turnOverlays[c]),l.turnOverlays[c]=null}),this.dispatchMeasureEvent(),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var e=new A(et.AREA_END,{points:this.points?this.points.slice(0):[],unit:this.options.unit,area:this.measureArea,overlay:this.overlay});this.dispatchEvent(e),this.scene.dispatchEvent(e)}}]),n}(qe),Xi=function(r){S(n,r);var t=P(n);function n(){var e;L(this,n);for(var i=arguments.length,s=Array(i),o=0;i>o;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).tolerance=.001,e.toleranceType="kilometers",e}return x(n,[{key:"polygonCutByLine",value:function(e,i,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},a=e.geometry,l=i.geometry;l.coordinates.length=l.coordinates.length-1;var u,c,h,p,f,v,g,d=[],y=[],w=null;if(a.type!=="Polygon"&&a.type!=="MultiPolygon"||l.type!=="LineString"||(s===void 0&&(s=""),ke(a,l).features.length===0)||kt(l,a))return w;y[0]=Ln(l,this.tolerance,{units:this.toleranceType}),y[1]=Ln(l,-this.tolerance,{units:this.toleranceType});for(var b=0;1>=b;b++){var E=b;d=[];for(var O=0;l.coordinates.length>O;O++)d.push(l.coordinates[O]);for(var Y=y[E].geometry.coordinates.length-1;Y>=0;Y--)d.push(y[E].geometry.coordinates[Y]);d.push(l.coordinates[0]);var C=wi(R(d));h=C,p=void 0,f=void 0,v=void 0,g=void 0,p=K(c=a),f=K(h),v=c.properties||{},u=(g=Ti(p.coordinates,f.coordinates)).length===0?null:g.length===1?ge(g[0],v):Oe(g,v)}var z=new BMapGL.GeoJSONParse().readFeaturesFromObject(u,o),q=[],ve=[];return z.forEach(function(le,fe){le.properties=Object.assign({},e.properties||{}),le.properties.id+="-".concat(fe),q.push(le),ve.push(le.toGeoJSON())}),{geojsonRes:ve,bdRes:q}}},{key:"lineCutByPoly",value:function(e,i,s){if(e.geometry===void 0||e.geometry.type.toLowerCase().indexOf("linestring")===-1)throw"传入的必须为linestring";var o=function(p,f){if(!p)throw Error("line is required");if(!f)throw Error("splitter is required");var v=ut(p),g=ut(f);if(v!=="LineString")throw Error("line must be LineString");if(g==="FeatureCollection")throw Error("splitter cannot be a FeatureCollection");if(g==="GeometryCollection")throw Error("splitter cannot be a GeometryCollection");var d=bi(f,{precision:7});switch(g){case"Point":return yt(p,d);case"MultiPoint":return yn(p,d);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return yn(p,ke(p,d))}}(e,i).features,a=[],l=new BMapGL.GeoJSONParse;if(o.length>1)for(var u=0,c=o.length;c>u;u++){var h=l.readFeatureFromObject(o[u],s);a.push(h)}return{geojsonRes:o,bdRes:a}}}]),n}(j),Vi=function(r){S(n,r);var t=P(n);function n(){var e;L(this,n);for(var i=arguments.length,s=Array(i),o=0;i>o;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).tolerance=.001,e.toleranceType="kilometers",e}return x(n,[{key:"polygonUnion",value:function(e,i){if(2>e.length)throw"至少2个数据";var s=null,o=!1;e.forEach(function(l,u){1>u?s=l:kt(s,l)?o=!0:s=Wn(s,l)});var a=o?null:s;return{geojsonRes:a,bdRes:new BMapGL.GeoJSONParse().readFeatureFromObject(a,i)}}}]),n}(j),Xn=function(r){S(n,r);var t=P(n);function n(){return L(this,n),t.apply(this,arguments)}return x(n,[{key:"geojsonMove",value:function(e,i,s){(i instanceof BMapGL.Point||i instanceof BMapGL.LatLng)&&(i=G([i.lng,i.lat])),(s instanceof BMapGL.Point||s instanceof BMapGL.LatLng)&&(s=G([s.lng,s.lat]));var o,a,l,u,c=function(h,p,f,v){if(!Ae(v=v||{}))throw Error("options is invalid");var g=v.units,d=v.zTranslation,y=v.mutate;if(!h)throw Error("geojson is required");if(p==null||isNaN(p))throw Error("distance is required");if(d&&typeof d!="number"&&isNaN(d))throw Error("zTranslation is not a number");if(d=d!==void 0?d:0,p===0&&d===0)return h;if(f==null||isNaN(f))throw Error("direction is required");return 0>p&&(p=-p,f+=180),y!==!1&&y!==void 0||(h=nn(h)),re(h,function(w){var b=Q(Ei(w,p,f,{units:g}));w[0]=b[0],w[1]=b[1],d&&w.length===3&&(w[2]+=d)}),h}(e,vn(i,s),(o=i,a=s,l===void 0&&(l={}),(u=l.final?Mn(F(a),F(o)):Mn(F(o),F(a)))>180?-(360-u):u));return c}}]),n}(j),De=function(r){S(n,r);var t=P(n);function n(e){var i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(L(this,n),(i=t.call(this)).currentModel=n.MODEL.MOVE,i.labelOptions=xe,i.baseOpts=Xt,i.enableSnap=!0,i.snapDistance=10,i.match=null,i.matchOverlay=null,i.matchOverlayRadius=1,!(e instanceof He))throw Error("MoveBase实例化必须输入scene参数");i.scene=e,i.scene.move=Le(i);var o={};return m.copyOptionsToNew(i.scene.options,s,o),m.copyNotExitOptions(o,i.scene.options),i.options=o,i.target=s.target||Le(i),i.setOptions(o),i.setSnapPointType(s),i.moveCalculate=new Xn,i.parse=new BMapGL.GeoJSONParse,i}return x(n,[{key:"setOptions",value:function(){this.defineProperty(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{})}},{key:"setCurrentModel",value:function(e){this.currentModel=e}},{key:"open",value:function(e,i){var s=this;this.scene&&(this.overlay=this.currentModel===n.MODEL.MOVE?e:this.parse.readFeatureFromObject(e.toGeoJSON()),this.scene.open(),this.setRunningAction(!0,function(){s.setSceneStatus(I.STATUS_MOVE),s.moveOpe(e),i&&i()}))}},{key:"close",value:function(e){this.overlay&&(this.setRunningAction(!1),this.setSceneStatus(I.STATUS_FREE),this.closeOpe(this.overlay),this.emitOkEvent(this.overlay),e&&e())}},{key:"moveOpe",value:function(e){}},{key:"closeOpe",value:function(e){}},{key:"emitOkEvent",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=new A(k.COMPLETE,{overlay:e,from:X.MOVE_ON_MAP,model:this.currentModel});this.dispatchEvent(s),i&&this.scene.dispatchEvent(s)}},{key:"setRunningAction",value:function(e,i){e?(this.scene.closeRunningAction(),this.scene.runningAction=this,this.scene.mask.show(),i()):(this.scene.runningAction=null,this.scene.mask.hide())}},{key:"setRadius",value:function(){var e=this.scene.map.getZoomUnits();this.matchOverlay.setRadius(this.matchOverlayRadius*e)}},{key:"addMatchOverlay",value:function(e){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(e),this.scene.map.addEventListener("zoomend",this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(e))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeEventListener("zoomend",this.setRadius.bind(this))}},{key:"getSnap",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=pe(e,i,o,a)),!l&&this.scene._attachSnapSource&&(l=pe(e,this.scene._attachSnapSource,o,a)),l||(l=pe(e,s,o,a)),l&&this.addMatchOverlay(l),l}}]),n}(j);De.MODEL={COPY:Symbol(),MOVE:Symbol()};var Vn=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this,e,i)).type=B.DRAWING_POLYLINE,s.scene.setCurrentDrawType(s.type),s}return x(n,[{key:"startAction",value:function(e){m.stopBubble(e),m.preventDefault(e),this.start=this.match?this.match:e.point,this.currentModel===De.MODEL.COPY&&(this.overlay.setOptions(this.baseOpts),this.scene.map.addOverlay(this.overlay)),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(e){m.preventDefault(e),m.stopBubble(e),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("移动改变位置<br>松开结束操作",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel);var i=e.point;this.enableSnap&&(this.match=this.currentModel===De.MODEL.COPY?this.getSnap(e.point,this.scene.instances):this.getSnap(e.point,this.scene.instances,[],this.snapDistance,this.scene.map,[this.overlay]),this.match&&(i=this.match),this.match=null);var s=this.moveCalculate.geojsonMove(this.source,this.start,i);this.overlay.updateByGeoJSON(s)}},{key:"endAction",value:function(e){m.preventDefault(e),m.stopBubble(e),this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.finish()}},{key:"mousemoveAction",value:function(e){m.preventDefault(e),m.stopBubble(e),this.enableSnap&&(this.match=this.getSnap(e.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行移动",{position:e.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"finish",value:function(){this.currentModel===De.MODEL.COPY&&this.scene.map.removeOverlay(this.overlay),this.emitOkEvent(this.overlay,!0);var e=new A(k.CHANGE,this.overlay);this.target.dispatchEvent(e),this.close()}},{key:"moveOpe",value:function(){this.source=this.overlay.toGeoJSON(),this.scene.mask.show(),this.scene.mask.addEventListener("mousemove",this.mousemove=this.mousemoveAction.bind(this)),this.scene.mask.addEventListener("mousedown",this.mousedown=this.startAction.bind(this))}},{key:"closeOpe",value:function(){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove)}}]),n}(De),Qi=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this,e,i)).type=B.DRAWING_POLYGON,s.scene.setCurrentDrawType(s.type),s}return x(n)}(Vn),Ki=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this)).otherOverlays=[],s.snapDistance=15,s.isOpen=!1,s.cursor="default",s.scene=e,s.isOpen=~~i,s._initEvent(),s}return x(n,[{key:"open",get:function(){return this.isOpen},set:function(e){this.isOpen=e}},{key:"distance",get:function(){return this.snapDistance},set:function(e){this.snapDistance=e}},{key:"setPickCursor",value:function(e){this.cursor=e}},{key:"_initEvent",value:function(){var e=this;this.scene&&(this.scene.addEventListener(k.CLICK,function(i){if(e.isOpen&&e.scene.currentStatus===I.STATUS_FREE){var s=e.getSnap(i.target.latlng);if(s){var o=Ft(s,3),a=new Qn(o[0],o[1]);e.dispatchEvent(new A(k.CLICK,a))}}}),this.scene.addEventListener(k.MOVE,function(i){if(e.isOpen&&e.scene.currentStatus===I.STATUS_FREE){var s=e.getSnap(i.target.latlng);if(s){e.scene.map.platform.style.cursor=e.cursor;var o=Ft(s,3),a=new Qn(o[0],o[1]);e.dispatchEvent(new A(k.MOVE,a))}else e.scene.map.platform.style.cursor=e.scene.map.config.defaultCursor,e.dispatchEvent(new A(k.MOVE,null))}}))}},{key:"attachOverlays",value:function(e){e instanceof Array&&(this.otherOverlays=e)}},{key:"getSnap",value:function(e){var i=null;return i||(i=this.getSnapByLL(e,this.scene.instances)),!i&&this.otherOverlays&&this.otherOverlays.length>0&&(i=this.getSnapByLL(e,this.otherOverlays)),i}},{key:"getSnapByLL",value:function(e,i){var s,o=(s=this.scene.map.getZoom(),Math.pow(2,18-s)),a=this.snapDistance*o;if(!(i&&i instanceof Array))return null;for(var l in i){var u=i[l];if(u instanceof BMapGL.Marker){var c=u.getPosition();if(a>1e3*N.getDistance(e,c,"kilometers"))return[u,0,c]}else{var h=u.getPath();for(var p in h){var f=h[p],v=1e3*N.getDistance(e,f,"kilometers");if(v&&a>v)return[u,p,f]}}}return null}}]),n}(j),Qn=function(r){S(n,r);var t=P(n);function n(e,i){var s;return L(this,n),(s=t.call(this))._index=-1,s.overlay=e,s.path=e instanceof BMapGL.Marker?[e.getPosition()]:e.getPath(),i>s.path.length-1||(s.index=i),s}return x(n,[{key:"index",get:function(){return this._index},set:function(e){this._index=parseInt(e)||0;var i=new A(k.CHANGE,this.index);this.dispatchEvent(i)}},{key:"getCurrentNode",value:function(){return this.path[this.index]}},{key:"updateNode",value:function(e,i){if(this.overlay instanceof BMapGL.Marker){var s=BMapGL.Projection.convertLL2MC(e);this.overlay.setPoint(s)}else i!==void 0&&i>=0&&this.path.length>i?this.path[i]=e:this.path[this.index]=e,this.overlay.setPath(this.path)}},{key:"hasNext",value:function(){return this.index+1>=0&&this.path.length>this.index+1}},{key:"next",value:function(){return this.hasNext()?(this._index++,this.path[this.index]):null}},{key:"hasPrev",value:function(){return this.index-1>=0&&this.path.length>this.index-1}},{key:"prev",value:function(){return this.hasPrev()?(this._index--,this.path[this.index]):null}}]),n}(j);M.ActionStatus=X,M.AreaMeasure=Ji,M.CircleDraw=Nt,M.CircleEdit=Jn,M.CorrectPoint=Ki,M.CutCalculate=Xi,M.DistanceMeasure=Yi,M.DrawControl=zi,M.DrawScene=He,M.DrawStatus=I,M.DrawingType=B,M.GeoCalculator=N,M.MapSelect=it,M.MarkerDraw=It,M.MarkerEdit=Wi,M.Measure=Ui,M.MeasureEvent=et,M.MoveCalculate=Xn,M.Operate=Re,M.OperateEventType=k,M.PolygonDraw=qe,M.PolygonEdit=jn,M.PolygonMove=Qi,M.PolylineDraw=Ne,M.PolylineEdit=Ct,M.PolylineMove=Vn,M.RectDraw=Rt,M.RectEdit=Yn,M.Select=ji,M.UnionCalculate=Vi,Object.defineProperty(M,"__esModule",{value:!0})})})(_t,_t.exports);var qi=_t.exports;const er=Zi({__proto__:null},[qi]);export{er as b};
